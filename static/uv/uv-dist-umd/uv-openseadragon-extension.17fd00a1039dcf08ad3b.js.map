{"version":3,"sources":["webpack://UV/./src/extensions/uv-openseadragon-extension/Bounds.ts","webpack://UV/./src/extensions/uv-openseadragon-extension/CroppedImageDimensions.ts","webpack://UV/./src/extensions/uv-openseadragon-extension/DownloadDialogue.ts","webpack://UV/./src/extensions/uv-openseadragon-extension/Extension.ts","webpack://UV/./src/extensions/uv-openseadragon-extension/MultiSelectionArgs.ts","webpack://UV/./src/extensions/uv-openseadragon-extension/SettingsDialogue.ts","webpack://UV/./src/extensions/uv-openseadragon-extension/ShareDialogue.ts","webpack://UV/./src/modules/uv-dialogues-module/ExternalContentDialogue.ts","webpack://UV/./src/modules/uv-dialogues-module/HelpDialogue.ts","webpack://UV/./src/modules/uv-multiselectdialogue-module/MultiSelectDialogue.ts","webpack://UV/./src/modules/uv-openseadragoncenterpanel-module/OpenSeadragonCenterPanel.ts","webpack://UV/./src/modules/uv-osdmobilefooterpanel-module/MobileFooter.ts","webpack://UV/./src/modules/uv-pagingheaderpanel-module/PagingHeaderPanel.ts","webpack://UV/./src/modules/uv-searchfooterpanel-module/FooterPanel.ts","webpack://UV/./src/modules/uv-shared-module/AnnotationResults.ts","webpack://UV/./src/modules/uv-shared-module/AutoComplete.ts","webpack://UV/./src/modules/uv-shared-module/Point.ts"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACiB;;;;;;;;;;;;;AChBlB;AAAA;AAAA;AAAA;AAAqC;AACwB;AAC7D;AACA;AACA,0BAA0B,kDAAI;AAC9B,6BAA6B,qEAAK;AAClC,wBAAwB,kDAAI;AAC5B;AACA;AACA,CAAC;AACiC;;;;;;;;;;;;;ACVlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACsE;AACuC;AAC/B;AAClB;AAClB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,uFAAc;AAC1B;AACA,YAAY,uFAAc;AAC1B;AACA;AACA;AACA;AACA,YAAY,uFAAc;AAC1B;AACA,YAAY,uFAAc;AAC1B;AACA,YAAY,uFAAc;AAC1B;AACA;AACA;AACA;AACA,YAAY,uFAAc;AAC1B;AACA,YAAY,uFAAc;AAC1B;AACA,YAAY,uFAAc;AAC1B;AACA;AACA;AACA;AACA,YAAY,uFAAc;AAC1B;AACA,YAAY,uFAAc;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,uFAAc;AAC1B;AACA,YAAY,uFAAc;AAC1B;AACA,YAAY,uFAAc;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,uFAAc;AACrC;AACA;AACA;AACA;AACA,+BAA+B,uFAAc;AAC7C;AACA;AACA,+BAA+B,uFAAc;AAC7C;AACA;AACA,4BAA4B,uFAAc;AAC1C;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,uFAAc;AACvC;AACA;AACA;AACA,yBAAyB,uFAAc;AACvC,wBAAwB,mDAAK;AAC7B;AACA,yBAAyB;AACzB,oDAAoD,+EAAU;AAC9D,yBAAyB;AACzB;AACA,yBAAyB,uFAAc;AACvC;AACA;AACA,yBAAyB,uFAAc;AACvC;AACA,uCAAuC,oBAAoB;AAC3D;AACA;AACA;AACA,yBAAyB,uFAAc;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,+EAAU;AAC9C;AACA;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA,oCAAoC,+EAAU;AAC9C,oCAAoC,+EAAU;AAC9C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,uFAAc;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,qDAAO;AAC7B,sBAAsB,qDAAO;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mDAAK;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,uFAAc;AACzD;AACA;AACA;AACA;AACA,uBAAuB,mDAAK;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,qDAAO;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,qDAAO;AAC7B,sBAAsB,qDAAO;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mDAAK;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,uFAAc;AACzD;AACA;AACA;AACA;AACA,uBAAuB,mDAAK;AAC5B;AACA;AACA;AACA;AACA,wBAAwB,qDAAO;AAC/B;AACA;AACA;AACA;AACA,gBAAgB,mDAAK;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,uFAAc;AACzD;AACA;AACA;AACA;AACA,kBAAkB,qDAAO;AACzB,kBAAkB,qDAAO;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mDAAK;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,uFAAc;AACzD;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mDAAK;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,uFAAc;AACzD;AACA,+BAA+B,0BAA0B;AACzD;AACA,0HAA0H,uFAAc;AACxI;AACA;AACA;AACA;AACA,2CAA2C,uFAAc;AACzD;AACA,2BAA2B,mBAAmB;AAC9C,wIAAwI,uFAAc;AACtJ;AACA;AACA;AACA,2CAA2C,uFAAc;AACzD,mHAAmH,uFAAc;AACjI;AACA;AACA,2CAA2C,uFAAc;AACzD,iJAAiJ,uFAAc;AAC/J;AACA,qIAAqI,uFAAc;AACnJ;AACA;AACA;AACA;AACA,2CAA2C,uFAAc;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,uFAAc;AACnC;AACA;AACA,qBAAqB,uFAAc;AACnC;AACA;AACA,qBAAqB,uFAAc;AACnC;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,iDAAI;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,iDAAI;AACvB;AACA;AACA;AACA;AACA,eAAe,kDAAK;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,uFAAc;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,uFAAc;AAC/B,iBAAiB,uFAAc;AAC/B,iBAAiB,uFAAc;AAC/B,iBAAiB,uFAAc;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,uFAAc;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,uFAAc;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,uFAAc;AAC/B;AACA,iBAAiB,uFAAc;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,8FAAoB;AACM;;;;;;;;;;;;;ACzkB5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACoF;AACd;AACM;AACV;AAC0B;AAC3B;AACZ;AACpB;AACkE;AACS;AACzB;AACN;AAChD;AACwD;AACa;AACG;AAC5C;AACsC;AACnC;AACwD;AAC/D;AACN;AACM;AACoC;AACzC;AACqB;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,+EAAU;AAC3C;AACA;AACA;AACA;AACA,wCAAwC,+EAAU;AAClD;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA;AACA;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA,oCAAoC,+EAAU;AAC9C,uBAAuB,+EAAU;AACjC,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA;AACA;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,SAAS;AACT,iCAAiC,+EAAU;AAC3C,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA,wCAAwC,+EAAU;AAClD;AACA;AACA;AACA;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA;AACA;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,6BAA6B,2CAAI;AACjC;AACA,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,+EAAU;AAC3C,2BAA2B,uEAAkB;AAC7C;AACA;AACA;AACA;AACA;AACA,uBAAuB,+EAAU;AACjC,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B;AACA,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,SAAS;AACT,iCAAiC,+EAAU;AAC3C,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,SAAS;AACT,iCAAiC,8CAAM;AACvC;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA,wCAAwC,+EAAU;AAClD;AACA;AACA;AACA;AACA,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,SAAS;AACT,iCAAiC,8CAAM;AACvC;AACA;AACA,wCAAwC,8CAAM;AAC9C;AACA,2BAA2B,8CAAM;AACjC;AACA;AACA,uBAAuB,8CAAM;AAC7B;AACA;AACA,aAAa;AACb,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,SAAS;AACT,iCAAiC,8CAAM;AACvC;AACA;AACA;AACA,uBAAuB,8CAAM;AAC7B,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,SAAS;AACT,iCAAiC,8CAAM;AACvC;AACA,uBAAuB,8CAAM;AAC7B;AACA,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B;AACA,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,SAAS;AACT,iCAAiC,8CAAM;AACvC,uBAAuB,8CAAM;AAC7B,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,SAAS;AACT,iCAAiC,+EAAU;AAC3C,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC,SAAS;AACT,iCAAiC,+EAAU;AAC3C,oCAAoC,+EAAU;AAC9C,SAAS;AACT,iCAAiC,+EAAU;AAC3C,uBAAuB,+EAAU;AACjC;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C;AACA;AACA;AACA,SAAS;AACT,iCAAiC,+EAAU;AAC3C,oCAAoC,+EAAU;AAC9C;AACA,oCAAoC,+EAAU;AAC9C,SAAS;AACT;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA,mCAAmC,yGAAiB;AACpD;AACA;AACA;AACA;AACA;AACA,iCAAiC,qGAAgB;AACjD;AACA;AACA;AACA;AACA,+BAA+B,8HAAwB;AACvD;AACA,kCAAkC,4GAAkB;AACpD;AACA;AACA;AACA;AACA;AACA,mCAAmC,6FAAW;AAC9C,yCAAyC,gGAAiB;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,uFAAY;AAC5C;AACA;AACA,oCAAoC,+FAAgB;AACpD;AACA;AACA,uCAAuC,+GAAmB;AAC1D;AACA;AACA,iCAAiC,6DAAa;AAC9C;AACA;AACA,oCAAoC,kEAAgB;AACpD;AACA;AACA,oCAAoC,mEAAgB;AACpD;AACA;AACA,2CAA2C,4GAAuB;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,+EAAU;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,oCAAoC,6FAAiB;AACrD;AACA;AACA,+BAA+B,+EAAU;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,8CAAM;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,8CAAM;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,0DAAY;AAC7B,uBAAuB,2CAAI;AAC3B,iBAAiB,0DAAY;AAC7B,uBAAuB,2CAAI;AAC3B;AACA,uBAAuB,2CAAI;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,+EAAU;AACzC;AACA;AACA;AACA;AACA,mCAAmC,+EAAU;AAC7C;AACA;AACA;AACA;AACA,mCAAmC,+EAAU;AAC7C;AACA;AACA;AACA,mCAAmC,+EAAU;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,kEAAgB;AACjC;AACA;AACA,iBAAiB,kEAAgB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,+EAAU;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,QAAQ;AACzD;AACA;AACA;AACA,uCAAuC,+EAAU;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,6BAA6B;AACpD;AACA;AACA,uCAAuC,+EAAU;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,2EAAQ;AACnC;AACA,yBAAyB,yDAAW;AACpC;AACA;AACA;AACA;AACA,wBAAwB,sEAAoB;AAC5C,kBAAkB,+EAAU;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,8CAAM;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,8EAAsB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,kDAAI;AACpC,mCAAmC,sEAAK;AACxC,8BAA8B,kDAAI;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,QAAQ,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,QAAQ;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,kDAAI;AACjC;AACA,wBAAwB,oDAAK;AAC7B;AACA;AACA;AACA;AACA;AACA,YAAY,QAAQ,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,QAAQ;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,qBAAqB;AAChD;AACA;AACA;AACA;AACA;AACA,oBAAoB,mDAAK;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,qBAAqB;AACpD;AACA;AACA;AACA;AACA;AACA,wBAAwB,mDAAK;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,sDAAO;AAC5B;AACA;AACA;AACA,qCAAqC,uCAAuC;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,oDAAK;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,uCAAuC;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,gEAAc;AACjD,+BAA+B,gEAAc;AAC7C;AACA;AACA;AACA;AACA;AACA,iCAAiC,EAAE;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,EAAE;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,sDAAO;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,+EAAU;AACtD,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,+DAAe;AACrD,oDAAoD,sDAAsD,EAAE;AAC5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,kCAAkC;AACzD;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,uCAAuC;AAC5E;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,qFAAa;AACA,qFAAsB,EAAC;;;;;;;;;;;;;ACt8BtC;AAAA;AAAA;AACA;AACA;AACA;AACA,CAAC;AAC6B;;;;;;;;;;;;;ACL9B;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AAC6G;AAC9G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,8FAAoB;AACM;;;;;;;;;;;;;AClI5B;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACiC;AACmE;AACrG;AACA;AACA;AACA;AACA,kCAAkC,8CAAM;AACxC;AACA,SAAS;AACT,kCAAkC,8CAAM;AACxC;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,wFAAiB;AACM;;;;;;;;;;;;;AC3CzB;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AAC2D;AACJ;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,uEAAU;AACrC,4BAA4B,uEAAU;AACtC;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,mEAAQ;AACyB;;;;;;;;;;;;;AC5CnC;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AAC2D;AACJ;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,uEAAU;AACrC,4BAA4B,uEAAU;AACtC;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,mEAAQ;AACc;;;;;;;;;;;;;AClDxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACsE;AACJ;AACK;AAClC;AAC0B;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,+EAAU;AACrC,4BAA4B,+EAAU;AACtC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,6EAAgB;AACpD;AACA,SAAS;AACT;AACA;AACA;AACA,oCAAoC,+EAAU;AAC9C;AACA,SAAS;AACT;AACA;AACA;AACA,gBAAgB,mDAAK;AACrB;AACA,gBAAgB,gFAAI;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,2EAAQ;AACqB;;;;;;;;;;;;;ACjG/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,iBAAiB,SAAI,IAAI,SAAI;AAC7B,2BAA2B,+DAA+D,gBAAgB,EAAE,EAAE;AAC9G;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,qFAAqF;AACpH;AACA,KAAK;AACL;AACA,mBAAmB,SAAI,IAAI,SAAI;AAC/B,aAAa,6BAA6B,0BAA0B,aAAa,EAAE,qBAAqB;AACxG,gBAAgB,qDAAqD,oEAAoE,aAAa,EAAE;AACxJ,sBAAsB,sBAAsB,qBAAqB,GAAG;AACpE;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC,kCAAkC,SAAS;AAC3C,kCAAkC,WAAW,UAAU;AACvD,yCAAyC,cAAc;AACvD;AACA,6GAA6G,OAAO,UAAU;AAC9H,gFAAgF,iBAAiB,OAAO;AACxG,wDAAwD,gBAAgB,QAAQ,OAAO;AACvF,8CAA8C,gBAAgB,gBAAgB,OAAO;AACrF;AACA,iCAAiC;AACjC;AACA;AACA,SAAS,YAAY,aAAa,OAAO,EAAE,UAAU,WAAW;AAChE,mCAAmC,SAAS;AAC5C;AACA;AACyD;AAClB;AACa;AACQ;AACgB;AACd;AACc;AAClC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,uEAAU;AAC3C;AACA;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C,2CAA2C;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,uEAAU;AAC7D;AACA;AACA,iBAAiB;AACjB,aAAa,EAAE,EAAE;AACjB,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,iCAAiC,oFAAM;AACvC;AACA;AACA,aAAa;AACb,SAAS;AACT,iCAAiC,oFAAM;AACvC;AACA;AACA,aAAa;AACb,SAAS;AACT,iCAAiC,oFAAM;AACvC;AACA;AACA,aAAa;AACb,SAAS;AACT,iCAAiC,oFAAM;AACvC;AACA;AACA,aAAa;AACb,SAAS;AACT,iCAAiC,oFAAM;AACvC;AACA;AACA,aAAa;AACb,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA,QAAQ,mDAAK;AACb;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,oDAAa;AAC3C;AACA;AACA;AACA;AACA;AACA,qCAAqC,mDAAK;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,mDAAK;AAC7C,qCAAqC,mDAAK;AAC1C;AACA,sCAAsC,mDAAK;AAC3C;AACA;AACA,qCAAqC,mDAAK;AAC1C,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA,mBAAmB;AACnB;AACA,4CAA4C,oFAAM;AAClD;AACA,iBAAiB;AACjB;AACA,4CAA4C,oFAAM;AAClD,iBAAiB;AACjB;AACA,4CAA4C,oFAAM;AAClD,iBAAiB;AACjB;AACA;AACA;AACA,4CAA4C,oFAAM;AAClD,iBAAiB;AACjB;AACA,4CAA4C,oFAAM;AAClD,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA,YAAY,iEAAgB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,oDAAa;AACjC,SAAS;AACT;AACA,oBAAoB,oDAAa;AACjC,SAAS;AACT;AACA,iBAAiB,iEAAgB;AACjC,iBAAiB,iEAAgB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,oDAAa;AACzB;AACA;AACA;AACA,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA;AACA,SAAS;AACT;AACA;AACA,YAAY,oDAAa;AACzB;AACA;AACA;AACA,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,mBAAmB;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,0BAA0B;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAsD,OAAO;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,0BAA0B;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,OAAO;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,oFAAM;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,iEAAgB;AAChC,qCAAqC,iEAAgB;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,wBAAwB;AAC/C;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,uDAAQ;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,oFAAM;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,kBAAkB;AACrD,uBAAuB,oDAAa;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,oFAAM;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,oFAAM;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,oBAAoB;AAC3C;AACA,2BAA2B,wBAAwB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,4BAA4B;AACnD;AACA;AACA,6BAA6B,wDAAU;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,mDAAK;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,QAAQ;AAC5D;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,uEAAU;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,oFAAM;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,4BAA4B;AAChF;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,uEAAU;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,oFAAM;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE,6DAA6D,EAAE;AACjI;AACA;AACA;AACA,oDAAoD,6DAA6D,EAAE;AACnH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,mDAAK;AACjB,iCAAiC,oFAAM;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,oFAAM;AACnC;AACA;AACA;AACA,+BAA+B,uEAAU;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qEAAqE,gDAAgD,EAAE;AACvH;AACA;AACA;AACA;AACA;AACA,uBAAuB,kCAAkC;AACzD;AACA;AACA;AACA;AACA;AACA,2BAA2B,oDAAa;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,uDAAQ;AACrC;AACA;AACA;AACA;AACA,YAAY,iEAAgB;AAC5B;AACA;AACA;AACA;AACA;AACA,qBAAqB,iEAAgB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iEAAgB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,mDAAK;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,yEAAW;AACuB;;;;;;;;;;;;;AC58BpC;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACgF;AACL;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,oFAAM;AAC1C,SAAS;AACT;AACA,oCAAoC,oFAAM;AAC1C,SAAS;AACT;AACA,oCAAoC,oFAAM;AAC1C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,CAAC,CAAC,yEAAe;AACM;;;;;;;;;;;;;ACnDvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AAC+D;AACJ;AACgB;AACd;AACU;AACjC;AACa;AACL;AACU;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,uEAAU;AAC3C;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,mDAAK;AACjB;AACA;AACA;AACA;AACA;AACA,gBAAgB,2EAAY;AAC5B;AACA;AACA;AACA;AACA,mCAAmC,qBAAqB;AACxD;AACA,oCAAoC,wDAAW;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,qBAAqB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa,UAAU,mDAAK;AAC5B;AACA,iBAAiB,mDAAK;AACtB;AACA;AACA;AACA;AACA,oCAAoC,uDAAuD;AAC3F;AACA,4BAA4B,uDAAQ,EAAE,wDAAW;AACjD;AACA;AACA;AACA;AACA,wCAAwC,oFAAM;AAC9C,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,yDAAY;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,yBAAyB;AAC3D,oCAAoC,oFAAM;AAC1C,SAAS;AACT;AACA;AACA,kCAAkC,yBAAyB;AAC3D,oCAAoC,oFAAM;AAC1C,SAAS;AACT;AACA,oCAAoC,uEAAU;AAC9C,SAAS;AACT;AACA;AACA;AACA,YAAY,iEAAgB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA;AACA,SAAS;AACT;AACA;AACA,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA;AACA,SAAS;AACT;AACA;AACA,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA;AACA,SAAS;AACT;AACA;AACA,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA,qBAAqB,iEAAgB;AACrC,4CAA4C,uEAAU;AACtD;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,oFAAM,eAAe,gFAAI;AACjE,aAAa;AACb;AACA,wCAAwC,oFAAM,eAAe,gFAAI;AACjE,aAAa;AACb;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA,YAAY;AACZ,aAAa,mDAAK;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,gFAAI;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mDAAK;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mDAAK;AACrB;AACA;AACA;AACA;AACA;AACA,6BAA6B,qDAAO;AACpC;AACA;AACA,6BAA6B,qDAAO;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,wDAAW;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,uEAAU;AAC7C;AACA;AACA;AACA,mCAAmC,oFAAM;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,uEAAU;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,uEAAU;AACjD;AACA;AACA,mCAAmC,oFAAM;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,iEAAgB;AAC5B,iCAAiC,iEAAgB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC,yEAAW;AACgB;;;;;;;;;;;;;ACxiB7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AAC+D;AACJ;AACgB;AACK;AACT;AACjC;AACQ;AACD;AACH;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,uEAAU;AAC3C;AACA;AACA;AACA;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA,SAAS;AACT;AACA,iCAAiC,oFAAM;AACvC;AACA,SAAS;AACT,iCAAiC,oFAAM;AACvC;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA;AACA;AACA;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA,SAAS;AACT,iCAAiC,uEAAU;AAC3C;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,mCAAmC,oFAAM;AACzC,SAAS;AACT;AACA;AACA,mCAAmC,oFAAM;AACzC;AACA;AACA;AACA,SAAS;AACT;AACA,mCAAmC,uEAAU;AAC7C,SAAS;AACT;AACA;AACA;AACA,uCAAuC,oFAAM;AAC7C;AACA,SAAS;AACT;AACA;AACA;AACA,uCAAuC,oFAAM;AAC7C;AACA,SAAS;AACT;AACA;AACA,mCAAmC,uEAAU;AAC7C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,2EAAY;AAC5B,0BAA0B,qDAAO;AACjC;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,aAAa,gBAAgB,mDAAK;AAClC;AACA;AACA;AACA,kCAAkC,yDAAgB;AAClD;AACA;AACA,aAAa;AACb;AACA;AACA,mCAAmC,oFAAM;AACzC,SAAS;AACT;AACA,oCAAoC,mDAAK;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,mDAAK;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,mDAAK;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,+BAA+B,oFAAM;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,0BAA0B;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,oFAAM;AACrC;AACA;AACA;AACA;AACA,sBAAsB,EAAE,EAAE,EAAE;AAC5B;AACA;AACA,wBAAwB,wDAAW;AACnC;AACA;AACA;AACA;AACA,wBAAwB,qDAAO;AAC/B;AACA;AACA;AACA,oBAAoB,qDAAO;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,qDAAO;AAC/B;AACA;AACA;AACA;AACA;AACA,uBAAuB,qDAAO;AAC9B;AACA;AACA;AACA,uBAAuB,qDAAO;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,+BAA+B,oFAAM;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,wDAAW;AACnC;AACA;AACA;AACA;AACA;AACA,6CAA6C,qDAAO,uCAAuC,uDAAQ,SAAS,uDAAQ;AACpH;AACA;AACA;AACA,yCAAyC,qDAAO;AAChD;AACA;AACA;AACA;AACA;AACA,gBAAgB,gFAAI;AACpB,aAAa,mDAAK;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,qDAAO;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,CAAC,CAAC,yEAAe;AACM;;;;;;;;;;;;;AC7lBvB;AAAA;AAAA;AACA;AACA;AACA;AACA,CAAC;AAC4B;;;;;;;;;;;;;ACL7B;AAAA;AAAA;AAAA;AAA8C;AACL;AACzC;AACA;AACA;AACA,+BAA+B,aAAa;AAC5C,kCAAkC,cAAc;AAChD,uCAAuC,uBAAuB;AAC9D,oCAAoC,oBAAoB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,2BAA2B,sDAAQ;AACnC;AACA,6BAA6B,yDAAgB;AAC7C;AACA;AACA,kCAAkC,yDAAgB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,8BAA8B,yDAAgB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,yDAAgB;AAClD;AACA;AACA,uCAAuC,yDAAgB;AACvD;AACA;AACA;AACA,uCAAuC,yDAAgB;AACvD;AACA;AACA;AACA;AACA,8BAA8B,yDAAgB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,0BAA0B;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACuB;;;;;;;;;;;;;AC9MxB;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACgB","file":"uv-openseadragon-extension.17fd00a1039dcf08ad3b.js","sourcesContent":["var Bounds = /** @class */ (function () {\n    function Bounds(x, y, w, h) {\n        this.x = x;\n        this.y = y;\n        this.w = w;\n        this.h = h;\n    }\n    Bounds.prototype.toString = function () {\n        return this.x + \",\" + this.y + \",\" + this.w + \",\" + this.h;\n    };\n    Bounds.fromString = function (bounds) {\n        var boundsArr = bounds.split(\",\");\n        return new Bounds(Number(boundsArr[0]), Number(boundsArr[1]), Number(boundsArr[2]), Number(boundsArr[3]));\n    };\n    return Bounds;\n}());\nexport { Bounds };\n","import { Size } from \"@edsilv/utils\";\nimport { Point } from \"../../modules/uv-shared-module/Point\";\nvar CroppedImageDimensions = /** @class */ (function () {\n    function CroppedImageDimensions() {\n        this.region = new Size(0, 0);\n        this.regionPos = new Point(0, 0);\n        this.size = new Size(0, 0);\n    }\n    return CroppedImageDimensions;\n}());\nexport { CroppedImageDimensions };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { BaseEvents } from \"../../modules/uv-shared-module/BaseEvents\";\nimport { DownloadDialogue as BaseDownloadDialogue } from \"../../modules/uv-dialogues-module/DownloadDialogue\";\nimport { DownloadOption } from \"../../modules/uv-shared-module/DownloadOption\";\nimport { Async, Strings, Bools, Files } from \"@edsilv/utils\";\nimport { Size, Utils } from \"manifesto.js\";\nvar DownloadDialogue = /** @class */ (function (_super) {\n    __extends(DownloadDialogue, _super);\n    function DownloadDialogue($element) {\n        return _super.call(this, $element) || this;\n    }\n    DownloadDialogue.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"downloadDialogue\");\n        _super.prototype.create.call(this);\n        // create ui.\n        this.$settingsButton = $('<a class=\"settings\" href=\"#\">' + this.content.editSettings + \"</a>\");\n        this.$pagingNote = $('<div class=\"pagingNote\">' + this.content.pagingNote + \" </div>\");\n        this.$pagingNote.append(this.$settingsButton);\n        this.$content.append(this.$pagingNote);\n        this.$imageOptionsContainer = $('<li class=\"group image\"></li>');\n        this.$downloadOptions.append(this.$imageOptionsContainer);\n        this.$imageOptions = $(\"<ul></ul>\");\n        this.$imageOptionsContainer.append(this.$imageOptions);\n        this.$currentViewAsJpgButton = $('<li class=\"option single\"><input id=\"' +\n            DownloadOption.CURRENT_VIEW +\n            '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label for=\"' +\n            DownloadOption.CURRENT_VIEW +\n            '\"></label></li>');\n        this.$imageOptions.append(this.$currentViewAsJpgButton);\n        this.$currentViewAsJpgButton.hide();\n        this.$wholeImageHighResButton = $('<li class=\"option single\"><input id=\"' +\n            DownloadOption.WHOLE_IMAGE_HIGH_RES +\n            '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label id=\"' +\n            DownloadOption.WHOLE_IMAGE_HIGH_RES +\n            'label\" for=\"' +\n            DownloadOption.WHOLE_IMAGE_HIGH_RES +\n            '\"></label></li>');\n        this.$imageOptions.append(this.$wholeImageHighResButton);\n        this.$wholeImageHighResButton.hide();\n        this.$wholeImagesHighResButton = $('<li class=\"option multiple\"><input id=\"' +\n            DownloadOption.WHOLE_IMAGES_HIGH_RES +\n            '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label id=\"' +\n            DownloadOption.WHOLE_IMAGES_HIGH_RES +\n            'label\" for=\"' +\n            DownloadOption.WHOLE_IMAGES_HIGH_RES +\n            '\"></label></li>');\n        this.$imageOptions.append(this.$wholeImagesHighResButton);\n        this.$wholeImageHighResButton.hide();\n        this.$wholeImageLowResAsJpgButton = $('<li class=\"option single\"><input id=\"' +\n            DownloadOption.WHOLE_IMAGE_LOW_RES +\n            '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label for=\"' +\n            DownloadOption.WHOLE_IMAGE_LOW_RES +\n            '\">' +\n            this.content.wholeImageLowResAsJpg +\n            \"</label></li>\");\n        this.$imageOptions.append(this.$wholeImageLowResAsJpgButton);\n        this.$wholeImageLowResAsJpgButton.hide();\n        this.$canvasOptionsContainer = $('<li class=\"group canvas\"></li>');\n        this.$downloadOptions.append(this.$canvasOptionsContainer);\n        this.$canvasOptions = $(\"<ul></ul>\");\n        this.$canvasOptionsContainer.append(this.$canvasOptions);\n        this.$manifestOptionsContainer = $('<li class=\"group manifest\"></li>');\n        this.$downloadOptions.append(this.$manifestOptionsContainer);\n        this.$manifestOptions = $(\"<ul></ul>\");\n        this.$manifestOptionsContainer.append(this.$manifestOptions);\n        this.$selectionButton = $('<li class=\"option\"><input id=\"' +\n            DownloadOption.SELECTION +\n            '\" type=\"radio\" name=\"downloadOptions\" tabindex=\"0\" /><label id=\"' +\n            DownloadOption.SELECTION +\n            'label\" for=\"' +\n            DownloadOption.SELECTION +\n            '\"></label></li>');\n        this.$manifestOptions.append(this.$selectionButton);\n        this.$selectionButton.hide();\n        this.$downloadButton = $('<a class=\"btn btn-primary\" href=\"#\" tabindex=\"0\">' +\n            this.content.download +\n            \"</a>\");\n        this.$buttons.prepend(this.$downloadButton);\n        this.$explanatoryTextTemplate = $('<span class=\"explanatory\"></span>');\n        var that = this;\n        // what happens on download is specific to the extension (except for renderings which need to be moved to the base download dialogue)\n        // todo: we need to make everything a list of radio button options in the base class, then we can unify everything into a single render method\n        this.$downloadButton.on(\"click\", function (e) {\n            e.preventDefault();\n            var $selectedOption = that.getSelectedOption();\n            var id = $selectedOption.attr(\"id\");\n            var label = $selectedOption.attr(\"title\");\n            var mime = $selectedOption.data(\"mime\");\n            var type = DownloadOption.UNKNOWN;\n            var canvas = _this.extension.helper.getCurrentCanvas();\n            if (_this.renderingUrls[id]) {\n                if (mime) {\n                    if (mime.toLowerCase().indexOf(\"pdf\") !== -1) {\n                        type = DownloadOption.ENTIRE_DOCUMENT_AS_PDF;\n                    }\n                    else if (mime.toLowerCase().indexOf(\"txt\") !== -1) {\n                        type = DownloadOption.ENTIRE_DOCUMENT_AS_TEXT;\n                    }\n                }\n                if ((type = DownloadOption.ENTIRE_DOCUMENT_AS_PDF)) {\n                    //var printService: manifesto.Service = this.extension.helper.manifest.getService(manifesto.ServiceProfile.printExtensions());\n                    // if downloading a pdf - if there's a print service, generate an event instead of opening a new window.\n                    // if (printService && this.extension.isOnHomeDomain()){\n                    //     this.component.publish(Events.PRINT);\n                    // } else {\n                    window.open(_this.renderingUrls[id]);\n                    //}\n                }\n            }\n            else {\n                type = id;\n                switch (type) {\n                    case DownloadOption.CURRENT_VIEW:\n                        var viewer = (that.extension).getViewer();\n                        window.open((that.extension.getCroppedImageUri(canvas, viewer)));\n                        break;\n                    case DownloadOption.SELECTION:\n                        Async.waitFor(function () {\n                            return !_this.isActive;\n                        }, function () {\n                            _this.component.publish(BaseEvents.SHOW_MULTISELECT_DIALOGUE);\n                        });\n                        break;\n                    case DownloadOption.WHOLE_IMAGE_HIGH_RES:\n                        window.open(_this.getCanvasHighResImageUri(_this.extension.helper.getCurrentCanvas()));\n                        break;\n                    case DownloadOption.WHOLE_IMAGES_HIGH_RES:\n                        var indices = _this.extension.getPagedIndices();\n                        for (var i = 0; i < indices.length; i++) {\n                            window.open(_this.getCanvasHighResImageUri(_this.extension.helper.getCanvasByIndex(indices[i])));\n                        }\n                        break;\n                    case DownloadOption.WHOLE_IMAGE_LOW_RES:\n                        var imageUri = (that.extension).getConfinedImageUri(canvas, that.options.confinedImageSize);\n                        if (imageUri) {\n                            window.open(imageUri);\n                        }\n                        break;\n                }\n            }\n            _this.component.publish(BaseEvents.DOWNLOAD, {\n                type: type,\n                label: label\n            });\n            _this.close();\n        });\n        this.$settingsButton.onPressed(function () {\n            _this.component.publish(BaseEvents.HIDE_DOWNLOAD_DIALOGUE);\n            _this.component.publish(BaseEvents.SHOW_SETTINGS_DIALOGUE);\n        });\n    };\n    DownloadDialogue.prototype.open = function (triggerButton) {\n        _super.prototype.open.call(this, triggerButton);\n        var canvas = this.extension.helper.getCurrentCanvas();\n        var rotation = (this.extension.getViewerRotation());\n        var hasNormalDimensions = rotation % 180 == 0;\n        if (this.isDownloadOptionAvailable(DownloadOption.CURRENT_VIEW)) {\n            var $input = this.$currentViewAsJpgButton.find(\"input\");\n            var $label = this.$currentViewAsJpgButton.find(\"label\");\n            var label = this.content.currentViewAsJpg;\n            var viewer = this.extension.getViewer();\n            var dimensions = this.extension.getCroppedImageDimensions(canvas, viewer);\n            // dimensions\n            if (dimensions) {\n                label = hasNormalDimensions\n                    ? Strings.format(label, dimensions.size.width.toString(), dimensions.size.height.toString())\n                    : Strings.format(label, dimensions.size.height.toString(), dimensions.size.width.toString());\n                $label.text(label);\n                $input.prop(\"title\", label);\n                this.$currentViewAsJpgButton.data(\"width\", dimensions.size.width);\n                this.$currentViewAsJpgButton.data(\"height\", dimensions.size.height);\n                this.$currentViewAsJpgButton.show();\n            }\n            else {\n                this.$currentViewAsJpgButton.hide();\n            }\n            // explanatory text\n            if (Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\n                var text = this.content.currentViewAsJpgExplanation;\n                if (text) {\n                    var $span = this.$explanatoryTextTemplate.clone();\n                    $span.text(text);\n                    $label.append($span);\n                }\n            }\n        }\n        else {\n            this.$currentViewAsJpgButton.hide();\n        }\n        if (this.isDownloadOptionAvailable(DownloadOption.WHOLE_IMAGE_HIGH_RES)) {\n            var $input = this.$wholeImageHighResButton.find(\"input\");\n            var $label = this.$wholeImageHighResButton.find(\"label\");\n            var mime = this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());\n            if (mime) {\n                mime = Files.simplifyMimeType(mime);\n            }\n            else {\n                mime = \"?\";\n            }\n            // dimensions\n            var size = this.getCanvasComputedDimensions(this.extension.helper.getCurrentCanvas());\n            if (!size) {\n                // if there is no image service, allow the image to be downloaded directly.\n                if (canvas.externalResource &&\n                    !canvas.externalResource.hasServiceDescriptor()) {\n                    var label = Strings.format(this.content.wholeImageHighRes, \"?\", \"?\", mime);\n                    $label.text(label);\n                    $input.prop(\"title\", label);\n                    this.$wholeImageHighResButton.show();\n                }\n                else {\n                    this.$wholeImageHighResButton.hide();\n                }\n            }\n            else {\n                var label = hasNormalDimensions\n                    ? Strings.format(this.content.wholeImageHighRes, size.width.toString(), size.height.toString(), mime)\n                    : Strings.format(this.content.wholeImageHighRes, size.height.toString(), size.width.toString(), mime);\n                $label.text(label);\n                $input.prop(\"title\", label);\n                this.$wholeImageHighResButton.data(\"width\", size.width);\n                this.$wholeImageHighResButton.data(\"height\", size.height);\n                this.$wholeImageHighResButton.show();\n            }\n            // explanatory text\n            if (Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\n                var text = this.content.wholeImageHighResExplanation;\n                if (text) {\n                    var $span = this.$explanatoryTextTemplate.clone();\n                    $span.text(text);\n                    $label.append($span);\n                }\n            }\n        }\n        else {\n            this.$wholeImageHighResButton.hide();\n        }\n        if (this.isDownloadOptionAvailable(DownloadOption.WHOLE_IMAGES_HIGH_RES)) {\n            var $input = this.$wholeImagesHighResButton.find(\"input\");\n            var $label = this.$wholeImagesHighResButton.find(\"label\");\n            var mime = this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());\n            if (mime) {\n                mime = Files.simplifyMimeType(mime);\n            }\n            else {\n                mime = \"?\";\n            }\n            var label = Strings.format(this.content.wholeImagesHighRes, mime);\n            $label.text(label);\n            $input.prop(\"title\", label);\n            this.$wholeImagesHighResButton.show();\n            // explanatory text\n            if (Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\n                var text = this.content.wholeImagesHighResExplanation;\n                if (text) {\n                    var $span = this.$explanatoryTextTemplate.clone();\n                    $span.text(text);\n                    $label.append($span);\n                }\n            }\n        }\n        else {\n            this.$wholeImagesHighResButton.hide();\n        }\n        if (this.isDownloadOptionAvailable(DownloadOption.WHOLE_IMAGE_LOW_RES)) {\n            var $input = this.$wholeImageLowResAsJpgButton.find(\"input\");\n            var $label = this.$wholeImageLowResAsJpgButton.find(\"label\");\n            var size = (this.extension).getConfinedImageDimensions(canvas, this.options.confinedImageSize);\n            var label = hasNormalDimensions\n                ? Strings.format(this.content.wholeImageLowResAsJpg, size.width.toString(), size.height.toString())\n                : Strings.format(this.content.wholeImageLowResAsJpg, size.height.toString(), size.width.toString());\n            $label.text(label);\n            $input.prop(\"title\", label);\n            this.$wholeImageLowResAsJpgButton.data(\"width\", size.width);\n            this.$wholeImageLowResAsJpgButton.data(\"height\", size.height);\n            this.$wholeImageLowResAsJpgButton.show();\n            // explanatory text\n            if (Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\n                var text = this.content.wholeImageLowResAsJpgExplanation;\n                if (text) {\n                    var $span = this.$explanatoryTextTemplate.clone();\n                    $span.text(text);\n                    $label.append($span);\n                }\n            }\n        }\n        else {\n            this.$wholeImageLowResAsJpgButton.hide();\n        }\n        if (this.isDownloadOptionAvailable(DownloadOption.SELECTION)) {\n            var $input = this.$selectionButton.find(\"input\");\n            var $label = this.$selectionButton.find(\"label\");\n            $label.text(this.content.downloadSelection);\n            $input.prop(\"title\", this.content.downloadSelection);\n            this.$selectionButton.show();\n            // explanatory text\n            if (Bools.getBool(this.options.optionsExplanatoryTextEnabled, false)) {\n                var text = this.content.selectionExplanation;\n                if (text) {\n                    var $span = this.$explanatoryTextTemplate.clone();\n                    $span.text(text);\n                    $label.append($span);\n                }\n            }\n        }\n        else {\n            this.$selectionButton.hide();\n        }\n        this.resetDynamicDownloadOptions();\n        if (this.isDownloadOptionAvailable(DownloadOption.RANGE_RENDERINGS)) {\n            if (canvas.ranges && canvas.ranges.length) {\n                for (var i = 0; i < canvas.ranges.length; i++) {\n                    var range = canvas.ranges[i];\n                    var renderingOptions = this.getDownloadOptionsForRenderings(range, this.content.entireFileAsOriginal, DownloadOption.CANVAS_RENDERINGS);\n                    this.addDownloadOptionsForRenderings(renderingOptions);\n                }\n            }\n        }\n        if (this.isDownloadOptionAvailable(DownloadOption.IMAGE_RENDERINGS)) {\n            var images = canvas.getImages();\n            for (var i = 0; i < images.length; i++) {\n                var renderingOptions = this.getDownloadOptionsForRenderings(images[i].getResource(), this.content.entireFileAsOriginal, DownloadOption.IMAGE_RENDERINGS);\n                this.addDownloadOptionsForRenderings(renderingOptions);\n            }\n        }\n        if (this.isDownloadOptionAvailable(DownloadOption.CANVAS_RENDERINGS)) {\n            var renderingOptions = this.getDownloadOptionsForRenderings(canvas, this.content.entireFileAsOriginal, DownloadOption.CANVAS_RENDERINGS);\n            this.addDownloadOptionsForRenderings(renderingOptions);\n        }\n        if (this.isDownloadOptionAvailable(DownloadOption.MANIFEST_RENDERINGS)) {\n            var renderingOptions = this.getDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(), this.content.entireDocument, DownloadOption.MANIFEST_RENDERINGS);\n            if (!renderingOptions.length && this.extension.helper.manifest) {\n                renderingOptions = this.getDownloadOptionsForRenderings(this.extension.helper.manifest, this.content.entireDocument, DownloadOption.MANIFEST_RENDERINGS);\n            }\n            this.addDownloadOptionsForRenderings(renderingOptions);\n        }\n        // hide the current view option if it's equivalent to whole image.\n        if (this.isDownloadOptionAvailable(DownloadOption.CURRENT_VIEW)) {\n            var currentWidth = parseInt(this.$currentViewAsJpgButton.data(\"width\").toString());\n            var currentHeight = parseInt(this.$currentViewAsJpgButton.data(\"height\").toString());\n            var wholeWidth = parseInt(this.$wholeImageHighResButton.data(\"width\").toString());\n            var wholeHeight = parseInt(this.$wholeImageHighResButton.data(\"height\").toString());\n            var percentageWidth = (currentWidth / wholeWidth) * 100;\n            var percentageHeight = (currentHeight / wholeHeight) * 100;\n            var disabledPercentage = this.options\n                .currentViewDisabledPercentage;\n            // if over disabledPercentage of the size of whole image\n            if (percentageWidth >= disabledPercentage &&\n                percentageHeight >= disabledPercentage) {\n                this.$currentViewAsJpgButton.hide();\n            }\n            else {\n                this.$currentViewAsJpgButton.show();\n            }\n        }\n        // order by image area\n        var $options = this.$imageOptions.find(\"li.single\");\n        $options = $options.sort(function (a, b) {\n            var aWidth = $(a).data(\"width\");\n            aWidth ? (aWidth = parseInt(aWidth.toString())) : 0;\n            var aHeight = $(a).data(\"height\");\n            aHeight ? (aHeight = parseInt(aHeight.toString())) : 0;\n            var bWidth = $(b).data(\"width\");\n            bWidth ? (bWidth = parseInt(bWidth.toString())) : 0;\n            var bHeight = $(b).data(\"height\");\n            bHeight ? (bHeight = parseInt(bHeight.toString())) : 0;\n            var aArea = aWidth * aHeight;\n            var bArea = bWidth * bHeight;\n            if (aArea < bArea) {\n                return -1;\n            }\n            if (aArea > bArea) {\n                return 1;\n            }\n            return 0;\n        });\n        $options.detach().appendTo(this.$imageOptions);\n        // hide empty groups\n        var $groups = this.$downloadOptions.find(\"li.group\");\n        $groups.each(function (index, group) {\n            var $group = $(group);\n            $group.show();\n            if ($group.find(\"li.option:hidden\").length ===\n                $group.find(\"li.option\").length) {\n                // all options are hidden, hide group.\n                $group.hide();\n            }\n        });\n        this.$downloadOptions\n            .find(\"li.group:visible\")\n            .last()\n            .addClass(\"lastVisible\");\n        if (this.extension.isPagingSettingEnabled() &&\n            this.config.options.downloadPagingNoteEnabled) {\n            this.$pagingNote.show();\n        }\n        else {\n            this.$pagingNote.hide();\n        }\n        if (!this.$downloadOptions.find(\"li.option:visible\").length) {\n            this.$noneAvailable.show();\n            this.$downloadButton.hide();\n        }\n        else {\n            // select first option.\n            this.$downloadOptions\n                .find(\"li.option input:visible:first\")\n                .prop(\"checked\", true);\n            this.$noneAvailable.hide();\n            this.$downloadButton.show();\n        }\n        this.resize();\n    };\n    DownloadDialogue.prototype.addDownloadOptionsForRenderings = function (renderingOptions) {\n        var _this = this;\n        renderingOptions.forEach(function (option) {\n            switch (option.type) {\n                case DownloadOption.IMAGE_RENDERINGS:\n                    _this.$imageOptions.append(option.button);\n                    break;\n                case DownloadOption.CANVAS_RENDERINGS:\n                    _this.$canvasOptions.append(option.button);\n                    break;\n                case DownloadOption.MANIFEST_RENDERINGS:\n                    _this.$manifestOptions.append(option.button);\n                    break;\n            }\n        });\n    };\n    DownloadDialogue.prototype.getCanvasImageResource = function (canvas) {\n        var images = canvas.getImages();\n        if (images[0]) {\n            return images[0].getResource();\n        }\n        return null;\n    };\n    DownloadDialogue.prototype.getCanvasHighResImageUri = function (canvas) {\n        var size = this.getCanvasComputedDimensions(canvas);\n        if (size) {\n            var width = size.width;\n            var uri = canvas.getCanonicalImageUri(width);\n            if (canvas.externalResource &&\n                canvas.externalResource.hasServiceDescriptor()) {\n                var uri_parts = uri.split(\"/\");\n                var rotation = (this.extension.getViewerRotation());\n                uri_parts[uri_parts.length - 2] = String(rotation);\n                uri = uri_parts.join(\"/\");\n            }\n            return uri;\n        }\n        else if (canvas.externalResource &&\n            !canvas.externalResource.hasServiceDescriptor()) {\n            // if there is no image service, return the dataUri.\n            return canvas.externalResource.dataUri;\n        }\n        return \"\";\n    };\n    DownloadDialogue.prototype.getCanvasMimeType = function (canvas) {\n        var resource = this.getCanvasImageResource(canvas);\n        if (resource) {\n            var format = resource.getFormat();\n            if (format) {\n                return format.toString();\n            }\n        }\n        return null;\n    };\n    DownloadDialogue.prototype.getCanvasDimensions = function (canvas) {\n        // externalResource may not have loaded yet\n        if (canvas.externalResource.data) {\n            var width = (canvas.externalResource.data).width;\n            var height = (canvas.externalResource.data).height;\n            if (width && height) {\n                return new Size(width, height);\n            }\n        }\n        return null;\n    };\n    DownloadDialogue.prototype.getCanvasComputedDimensions = function (canvas) {\n        var imageSize = this.getCanvasDimensions(canvas);\n        var requiredSize = canvas.getMaxDimensions();\n        if (!imageSize) {\n            return null;\n        }\n        if (!requiredSize) {\n            return imageSize;\n        }\n        if (imageSize.width <= requiredSize.width &&\n            imageSize.height <= requiredSize.height) {\n            return imageSize;\n        }\n        var scaleW = requiredSize.width / imageSize.width;\n        var scaleH = requiredSize.height / imageSize.height;\n        var scale = Math.min(scaleW, scaleH);\n        return new Size(Math.floor(imageSize.width * scale), Math.floor(imageSize.height * scale));\n    };\n    DownloadDialogue.prototype._isLevel0 = function (profile) {\n        if (!profile || !profile.length)\n            return false;\n        return Utils.isLevel0ImageProfile(profile[0]);\n    };\n    DownloadDialogue.prototype.isDownloadOptionAvailable = function (option) {\n        if (!this.extension.resources) {\n            return false;\n        }\n        var canvas = this.extension.helper.getCurrentCanvas();\n        // if the external resource doesn't have a service descriptor or is level 0\n        // only allow wholeImageHighRes\n        if (!canvas.externalResource.hasServiceDescriptor() ||\n            this._isLevel0(canvas.externalResource.data.profile)) {\n            if (option === DownloadOption.WHOLE_IMAGE_HIGH_RES) {\n                // if in one-up mode, or in two-up mode with a single page being shown\n                if (!this.extension.isPagingSettingEnabled() ||\n                    (this.extension.isPagingSettingEnabled() &&\n                        this.extension.resources &&\n                        this.extension.resources.length === 1)) {\n                    return true;\n                }\n            }\n            return false;\n        }\n        switch (option) {\n            case DownloadOption.CURRENT_VIEW:\n            case DownloadOption.CANVAS_RENDERINGS:\n            case DownloadOption.IMAGE_RENDERINGS:\n            case DownloadOption.WHOLE_IMAGE_HIGH_RES:\n                // if in one-up mode, or in two-up mode with a single page being shown\n                if (!this.extension.isPagingSettingEnabled() ||\n                    (this.extension.isPagingSettingEnabled() &&\n                        this.extension.resources &&\n                        this.extension.resources.length === 1)) {\n                    var maxDimensions = canvas.getMaxDimensions();\n                    if (maxDimensions) {\n                        if (maxDimensions.width <= this.options.maxImageWidth) {\n                            return true;\n                        }\n                        else {\n                            return false;\n                        }\n                    }\n                    return true;\n                }\n                return false;\n            case DownloadOption.WHOLE_IMAGES_HIGH_RES:\n                if (this.extension.isPagingSettingEnabled() &&\n                    this.extension.resources &&\n                    this.extension.resources.length > 1) {\n                    return true;\n                }\n                return false;\n            case DownloadOption.WHOLE_IMAGE_LOW_RES:\n                // hide low-res option if hi-res width is smaller than constraint\n                var size = this.getCanvasComputedDimensions(canvas);\n                if (!size) {\n                    return false;\n                }\n                return (!this.extension.isPagingSettingEnabled() &&\n                    size.width > this.options.confinedImageSize);\n            case DownloadOption.SELECTION:\n                return this.options.selectionEnabled;\n            case DownloadOption.RANGE_RENDERINGS:\n                if (canvas.ranges && canvas.ranges.length) {\n                    var range = canvas.ranges[0];\n                    return range.getRenderings().length > 0;\n                }\n                return false;\n            default:\n                return _super.prototype.isDownloadOptionAvailable.call(this, option);\n        }\n    };\n    return DownloadDialogue;\n}(BaseDownloadDialogue));\nexport { DownloadDialogue };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnnotationResults } from \"../../modules/uv-shared-module/AnnotationResults\";\nimport { BaseEvents } from \"../../modules/uv-shared-module/BaseEvents\";\nimport { BaseExtension } from \"../../modules/uv-shared-module/BaseExtension\";\nimport { Bookmark } from \"../../modules/uv-shared-module/Bookmark\";\nimport { ContentLeftPanel } from \"../../modules/uv-contentleftpanel-module/ContentLeftPanel\";\nimport { CroppedImageDimensions } from \"./CroppedImageDimensions\";\nimport { DownloadDialogue } from \"./DownloadDialogue\";\nimport { Events } from \"./Events\";\nimport { ExternalContentDialogue } from \"../../modules/uv-dialogues-module/ExternalContentDialogue\";\nimport { FooterPanel as MobileFooterPanel } from \"../../modules/uv-osdmobilefooterpanel-module/MobileFooter\";\nimport { FooterPanel } from \"../../modules/uv-searchfooterpanel-module/FooterPanel\";\nimport { HelpDialogue } from \"../../modules/uv-dialogues-module/HelpDialogue\";\nimport { Mode } from \"./Mode\";\nimport { MoreInfoDialogue } from \"../../modules/uv-dialogues-module/MoreInfoDialogue\";\nimport { MoreInfoRightPanel } from \"../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel\";\nimport { MultiSelectDialogue } from \"../../modules/uv-multiselectdialogue-module/MultiSelectDialogue\";\nimport { MultiSelectionArgs } from \"./MultiSelectionArgs\";\nimport { PagingHeaderPanel } from \"../../modules/uv-pagingheaderpanel-module/PagingHeaderPanel\";\nimport { Point } from \"../../modules/uv-shared-module/Point\";\nimport { OpenSeadragonCenterPanel } from \"../../modules/uv-openseadragoncenterpanel-module/OpenSeadragonCenterPanel\";\nimport { SettingsDialogue } from \"./SettingsDialogue\";\nimport { ShareDialogue } from \"./ShareDialogue\";\nimport { Bools, Maths, Strings } from \"@edsilv/utils\";\nimport { IIIFResourceType, ExternalResourceType, ServiceProfile } from \"@iiif/vocabulary\";\nimport { AnnotationGroup } from \"@iiif/manifold\";\nimport { ManifestType, LanguageMap, Size, Utils } from \"manifesto.js\";\nvar OpenSeadragonExtension = /** @class */ (function (_super) {\n    __extends(OpenSeadragonExtension, _super);\n    function OpenSeadragonExtension() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.annotations = [];\n        _this.currentRotation = 0;\n        _this.isAnnotating = false;\n        return _this;\n    }\n    OpenSeadragonExtension.prototype.create = function () {\n        var _this = this;\n        _super.prototype.create.call(this);\n        this.component.subscribe(BaseEvents.METRIC_CHANGED, function () {\n            if (!_this.isDesktopMetric()) {\n                var settings = {};\n                settings.pagingEnabled = false;\n                _this.updateSettings(settings);\n                _this.component.publish(BaseEvents.UPDATE_SETTINGS);\n                _this.shell.$rightPanel.hide();\n            }\n            else {\n                _this.shell.$rightPanel.show();\n            }\n        });\n        this.component.subscribe(BaseEvents.CANVAS_INDEX_CHANGED, function (canvasIndex) {\n            _this.previousAnnotationRect = null;\n            _this.currentAnnotationRect = null;\n            _this.viewPage(canvasIndex);\n        });\n        this.component.subscribe(BaseEvents.CLEAR_ANNOTATIONS, function () {\n            _this.clearAnnotations();\n            _this.component.publish(BaseEvents.ANNOTATIONS_CLEARED);\n            _this.fire(BaseEvents.CLEAR_ANNOTATIONS);\n        });\n        this.component.subscribe(BaseEvents.DOWN_ARROW, function () {\n            if (!_this.useArrowKeysToNavigate()) {\n                _this.centerPanel.setFocus();\n            }\n        });\n        this.component.subscribe(BaseEvents.END, function () {\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.helper.getLastPageIndex());\n        });\n        this.component.subscribe(BaseEvents.FIRST, function () {\n            _this.fire(BaseEvents.FIRST);\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.helper.getFirstPageIndex());\n        });\n        this.component.subscribe(BaseEvents.GALLERY_DECREASE_SIZE, function () {\n            _this.fire(BaseEvents.GALLERY_DECREASE_SIZE);\n        });\n        this.component.subscribe(BaseEvents.GALLERY_INCREASE_SIZE, function () {\n            _this.fire(BaseEvents.GALLERY_INCREASE_SIZE);\n        });\n        this.component.subscribe(BaseEvents.GALLERY_THUMB_SELECTED, function () {\n            _this.fire(BaseEvents.GALLERY_THUMB_SELECTED);\n        });\n        this.component.subscribe(BaseEvents.HOME, function () {\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.helper.getFirstPageIndex());\n        });\n        this.component.subscribe(Events.IMAGE_SEARCH, function (index) {\n            _this.fire(Events.IMAGE_SEARCH, index);\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, index);\n        });\n        this.component.subscribe(BaseEvents.LAST, function () {\n            _this.fire(BaseEvents.LAST);\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.helper.getLastPageIndex());\n        });\n        this.component.subscribe(BaseEvents.LEFT_ARROW, function () {\n            if (_this.useArrowKeysToNavigate()) {\n                _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.getPrevPageIndex());\n            }\n            else {\n                _this.centerPanel.setFocus();\n            }\n        });\n        this.component.subscribe(BaseEvents.LEFTPANEL_COLLAPSE_FULL_START, function () {\n            if (_this.isDesktopMetric()) {\n                _this.shell.$rightPanel.show();\n            }\n        });\n        this.component.subscribe(BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH, function () {\n            _this.shell.$centerPanel.show();\n            _this.resize();\n        });\n        this.component.subscribe(BaseEvents.LEFTPANEL_EXPAND_FULL_START, function () {\n            _this.shell.$centerPanel.hide();\n            _this.shell.$rightPanel.hide();\n        });\n        this.component.subscribe(BaseEvents.MINUS, function () {\n            _this.centerPanel.setFocus();\n        });\n        this.component.subscribe(Events.MODE_CHANGED, function (mode) {\n            _this.fire(Events.MODE_CHANGED, mode);\n            _this.mode = new Mode(mode);\n            var settings = _this.getSettings();\n            _this.component.publish(BaseEvents.SETTINGS_CHANGED, settings);\n        });\n        this.component.subscribe(BaseEvents.MULTISELECTION_MADE, function (ids) {\n            var args = new MultiSelectionArgs();\n            args.manifestUri = _this.helper.manifestUri;\n            args.allCanvases = ids.length === _this.helper.getCanvases().length;\n            args.canvases = ids;\n            args.format = _this.data.config.options.multiSelectionMimeType;\n            args.sequence = _this.helper.getCurrentSequence().id;\n            _this.fire(BaseEvents.MULTISELECTION_MADE, args);\n        });\n        this.component.subscribe(BaseEvents.NEXT, function () {\n            _this.fire(BaseEvents.NEXT);\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.getNextPageIndex());\n        });\n        this.component.subscribe(Events.NEXT_SEARCH_RESULT, function () {\n            _this.fire(Events.NEXT_SEARCH_RESULT);\n        });\n        this.component.subscribe(Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE, function () {\n            _this.fire(Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE);\n            _this.nextSearchResult();\n        });\n        this.component.subscribe(Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE, function () {\n            _this.fire(Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE);\n            _this.prevSearchResult();\n        });\n        this.component.subscribe(BaseEvents.OPEN_THUMBS_VIEW, function () {\n            _this.fire(BaseEvents.OPEN_THUMBS_VIEW);\n        });\n        this.component.subscribe(BaseEvents.OPEN_TREE_VIEW, function () {\n            _this.fire(BaseEvents.OPEN_TREE_VIEW);\n        });\n        this.component.subscribe(BaseEvents.PAGE_DOWN, function () {\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.getNextPageIndex());\n        });\n        this.component.subscribe(Events.PAGE_SEARCH, function (value) {\n            _this.fire(Events.PAGE_SEARCH, value);\n            _this.viewLabel(value);\n        });\n        this.component.subscribe(BaseEvents.PAGE_UP, function () {\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.getPrevPageIndex());\n        });\n        this.component.subscribe(Events.PAGING_TOGGLED, function (obj) {\n            _this.fire(Events.PAGING_TOGGLED, obj);\n        });\n        this.component.subscribe(BaseEvents.PLUS, function () {\n            _this.centerPanel.setFocus();\n        });\n        this.component.subscribe(BaseEvents.PREV, function () {\n            _this.fire(BaseEvents.PREV);\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.getPrevPageIndex());\n        });\n        this.component.subscribe(Events.PREV_SEARCH_RESULT, function () {\n            _this.fire(Events.PREV_SEARCH_RESULT);\n        });\n        this.component.subscribe(Events.PRINT, function () {\n            _this.print();\n        });\n        this.component.subscribe(BaseEvents.RELOAD, function () {\n            _this.component.publish(BaseEvents.CLEAR_ANNOTATIONS);\n        });\n        this.component.subscribe(BaseEvents.RIGHT_ARROW, function () {\n            if (_this.useArrowKeysToNavigate()) {\n                _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.getNextPageIndex());\n            }\n            else {\n                _this.centerPanel.setFocus();\n            }\n        });\n        this.component.subscribe(Events.OPENSEADRAGON_ANIMATION, function () {\n            _this.fire(Events.OPENSEADRAGON_ANIMATION);\n        });\n        this.component.subscribe(Events.OPENSEADRAGON_ANIMATION_FINISH, function (viewer) {\n            var bounds = _this.centerPanel.getViewportBounds();\n            if (_this.centerPanel && bounds) {\n                _this.component.publish(Events.XYWH_CHANGED, bounds.toString());\n                _this.data.xywh = bounds.toString();\n                _this.fire(Events.XYWH_CHANGED, _this.data.xywh);\n            }\n            var canvas = _this.helper.getCurrentCanvas();\n            _this.fire(Events.CURRENT_VIEW_URI, {\n                cropUri: _this.getCroppedImageUri(canvas, _this.getViewer()),\n                fullUri: _this.getConfinedImageUri(canvas, canvas.getWidth())\n            });\n        });\n        this.component.subscribe(Events.OPENSEADRAGON_ANIMATION_START, function () {\n            _this.fire(Events.OPENSEADRAGON_ANIMATION_START);\n        });\n        this.component.subscribe(Events.OPENSEADRAGON_OPEN, function () {\n            if (!_this.useArrowKeysToNavigate()) {\n                _this.centerPanel.setFocus();\n            }\n            _this.fire(Events.OPENSEADRAGON_OPEN);\n        });\n        this.component.subscribe(Events.OPENSEADRAGON_RESIZE, function () {\n            _this.fire(Events.OPENSEADRAGON_RESIZE);\n        });\n        this.component.subscribe(Events.OPENSEADRAGON_ROTATION, function (rotation) {\n            _this.data.rotation = rotation;\n            _this.fire(Events.OPENSEADRAGON_ROTATION, _this.data.rotation);\n            _this.currentRotation = rotation;\n        });\n        this.component.subscribe(Events.SEARCH, function (terms) {\n            _this.fire(Events.SEARCH, terms);\n            _this.search(terms);\n        });\n        this.component.subscribe(Events.SEARCH_PREVIEW_FINISH, function () {\n            _this.fire(Events.SEARCH_PREVIEW_FINISH);\n        });\n        this.component.subscribe(Events.SEARCH_PREVIEW_START, function () {\n            _this.fire(Events.SEARCH_PREVIEW_START);\n        });\n        this.component.subscribe(BaseEvents.ANNOTATIONS, function (obj) {\n            _this.fire(BaseEvents.ANNOTATIONS, obj);\n        });\n        this.component.subscribe(BaseEvents.ANNOTATION_CANVAS_CHANGED, function (rects) {\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, rects[0].canvasIndex);\n        });\n        this.component.subscribe(BaseEvents.ANNOTATIONS_EMPTY, function () {\n            _this.fire(BaseEvents.ANNOTATIONS_EMPTY);\n        });\n        this.component.subscribe(BaseEvents.THUMB_SELECTED, function (thumb) {\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, thumb.index);\n        });\n        this.component.subscribe(BaseEvents.TREE_NODE_SELECTED, function (node) {\n            _this.fire(BaseEvents.TREE_NODE_SELECTED, node.data.path);\n            _this.treeNodeSelected(node);\n        });\n        this.component.subscribe(BaseEvents.UP_ARROW, function () {\n            if (!_this.useArrowKeysToNavigate()) {\n                _this.centerPanel.setFocus();\n            }\n        });\n        this.component.subscribe(BaseEvents.UPDATE_SETTINGS, function () {\n            _this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.helper.canvasIndex);\n            var settings = _this.getSettings();\n            _this.component.publish(BaseEvents.SETTINGS_CHANGED, settings);\n        });\n        // this.component.subscribe(Events.VIEW_PAGE, (e: any, index: number) => {\n        //     this.fire(Events.VIEW_PAGE, index);\n        //     this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, [index]);\n        // });\n    };\n    OpenSeadragonExtension.prototype.createModules = function () {\n        _super.prototype.createModules.call(this);\n        if (this.isHeaderPanelEnabled()) {\n            this.headerPanel = new PagingHeaderPanel(this.shell.$headerPanel);\n        }\n        else {\n            this.shell.$headerPanel.hide();\n        }\n        if (this.isLeftPanelEnabled()) {\n            this.leftPanel = new ContentLeftPanel(this.shell.$leftPanel);\n        }\n        else {\n            this.shell.$leftPanel.hide();\n        }\n        this.centerPanel = new OpenSeadragonCenterPanel(this.shell.$centerPanel);\n        if (this.isRightPanelEnabled()) {\n            this.rightPanel = new MoreInfoRightPanel(this.shell.$rightPanel);\n        }\n        else {\n            this.shell.$rightPanel.hide();\n        }\n        if (this.isFooterPanelEnabled()) {\n            this.footerPanel = new FooterPanel(this.shell.$footerPanel);\n            this.mobileFooterPanel = new MobileFooterPanel(this.shell.$mobileFooterPanel);\n        }\n        else {\n            this.shell.$footerPanel.hide();\n        }\n        this.$helpDialogue = $('<div class=\"overlay help\" aria-hidden=\"true\"></div>');\n        this.shell.$overlays.append(this.$helpDialogue);\n        this.helpDialogue = new HelpDialogue(this.$helpDialogue);\n        this.$moreInfoDialogue = $('<div class=\"overlay moreInfo\" aria-hidden=\"true\"></div>');\n        this.shell.$overlays.append(this.$moreInfoDialogue);\n        this.moreInfoDialogue = new MoreInfoDialogue(this.$moreInfoDialogue);\n        this.$multiSelectDialogue = $('<div class=\"overlay multiSelect\" aria-hidden=\"true\"></div>');\n        this.shell.$overlays.append(this.$multiSelectDialogue);\n        this.multiSelectDialogue = new MultiSelectDialogue(this.$multiSelectDialogue);\n        this.$shareDialogue = $('<div class=\"overlay share\" aria-hidden=\"true\"></div>');\n        this.shell.$overlays.append(this.$shareDialogue);\n        this.shareDialogue = new ShareDialogue(this.$shareDialogue);\n        this.$downloadDialogue = $('<div class=\"overlay download\" aria-hidden=\"true\"></div>');\n        this.shell.$overlays.append(this.$downloadDialogue);\n        this.downloadDialogue = new DownloadDialogue(this.$downloadDialogue);\n        this.$settingsDialogue = $('<div class=\"overlay settings\" aria-hidden=\"true\"></div>');\n        this.shell.$overlays.append(this.$settingsDialogue);\n        this.settingsDialogue = new SettingsDialogue(this.$settingsDialogue);\n        this.$externalContentDialogue = $('<div class=\"overlay externalContent\" aria-hidden=\"true\"></div>');\n        this.shell.$overlays.append(this.$externalContentDialogue);\n        this.externalContentDialogue = new ExternalContentDialogue(this.$externalContentDialogue);\n        if (this.isHeaderPanelEnabled()) {\n            this.headerPanel.init();\n        }\n        if (this.isLeftPanelEnabled()) {\n            this.leftPanel.init();\n        }\n        if (this.isRightPanelEnabled()) {\n            this.rightPanel.init();\n        }\n        if (this.isFooterPanelEnabled()) {\n            this.footerPanel.init();\n        }\n    };\n    OpenSeadragonExtension.prototype.render = function () {\n        _super.prototype.render.call(this);\n        this.checkForAnnotations();\n        this.checkForSearchParam();\n        this.checkForRotationParam();\n    };\n    OpenSeadragonExtension.prototype.checkForAnnotations = function () {\n        if (this.data.annotations) {\n            var annotations = this.parseAnnotationList(this.data.annotations);\n            this.component.publish(BaseEvents.CLEAR_ANNOTATIONS);\n            this.annotate(annotations);\n        }\n    };\n    OpenSeadragonExtension.prototype.annotate = function (annotations, terms) {\n        this.annotations = annotations;\n        // sort the annotations by canvasIndex\n        this.annotations = annotations.sort(function (a, b) {\n            return a.canvasIndex - b.canvasIndex;\n        });\n        var annotationResults = new AnnotationResults();\n        annotationResults.terms = terms;\n        annotationResults.annotations = this.annotations;\n        this.component.publish(BaseEvents.ANNOTATIONS, annotationResults);\n        // reload current index as it may contain annotations.\n        //this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, [this.helper.canvasIndex]);\n    };\n    OpenSeadragonExtension.prototype.checkForSearchParam = function () {\n        // if a highlight param is set, use it to search.\n        var highlight = this.data\n            .highlight;\n        if (highlight) {\n            highlight.replace(/\\+/g, \" \").replace(/\"/g, \"\");\n            this.component.publish(Events.SEARCH, highlight);\n        }\n    };\n    OpenSeadragonExtension.prototype.checkForRotationParam = function () {\n        // if a rotation value is passed, set rotation\n        var rotation = this.data\n            .rotation;\n        if (rotation) {\n            this.component.publish(Events.OPENSEADRAGON_ROTATION, rotation);\n        }\n    };\n    OpenSeadragonExtension.prototype.viewPage = function (canvasIndex) {\n        // if it's an invalid canvas index.\n        if (canvasIndex === -1)\n            return;\n        var isReload = false;\n        if (canvasIndex === this.helper.canvasIndex) {\n            isReload = true;\n        }\n        if (this.helper.isCanvasIndexOutOfRange(canvasIndex)) {\n            this.showMessage(this.data.config.content.canvasIndexOutOfRange);\n            canvasIndex = 0;\n        }\n        if (this.isPagingSettingEnabled() && !isReload) {\n            var indices = this.getPagedIndices(canvasIndex);\n            // if the page is already displayed, only advance canvasIndex.\n            if (indices.includes(this.helper.canvasIndex)) {\n                this.viewCanvas(canvasIndex);\n                return;\n            }\n        }\n        this.viewCanvas(canvasIndex);\n    };\n    OpenSeadragonExtension.prototype.getViewer = function () {\n        return this.centerPanel.viewer;\n    };\n    OpenSeadragonExtension.prototype.getMode = function () {\n        if (this.mode)\n            return this.mode;\n        switch (this.helper.getManifestType()) {\n            case ManifestType.MONOGRAPH:\n                return Mode.page;\n            case ManifestType.MANUSCRIPT:\n                return Mode.page;\n            default:\n                return Mode.image;\n        }\n    };\n    OpenSeadragonExtension.prototype.getViewportBounds = function () {\n        if (!this.centerPanel)\n            return null;\n        var bounds = this.centerPanel.getViewportBounds();\n        if (bounds) {\n            return bounds.toString();\n        }\n        return null;\n    };\n    OpenSeadragonExtension.prototype.getViewerRotation = function () {\n        if (!this.centerPanel)\n            return null;\n        return this.currentRotation;\n    };\n    OpenSeadragonExtension.prototype.viewRange = function (path) {\n        //this.currentRangePath = path;\n        var range = this.helper.getRangeByPath(path);\n        if (!range)\n            return;\n        var canvasId = range.getCanvasIds()[0];\n        var index = this.helper.getCanvasIndexById(canvasId);\n        this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, index);\n    };\n    OpenSeadragonExtension.prototype.viewLabel = function (label) {\n        if (!label) {\n            this.showMessage(this.data.config.modules.genericDialogue.content.emptyValue);\n            this.component.publish(BaseEvents.CANVAS_INDEX_CHANGE_FAILED);\n            return;\n        }\n        var index = this.helper.getCanvasIndexByLabel(label);\n        if (index != -1) {\n            this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, index);\n        }\n        else {\n            this.showMessage(this.data.config.modules.genericDialogue.content.pageNotFound);\n            this.component.publish(BaseEvents.CANVAS_INDEX_CHANGE_FAILED);\n        }\n    };\n    OpenSeadragonExtension.prototype.treeNodeSelected = function (node) {\n        var data = node.data;\n        if (!data.type)\n            return;\n        switch (data.type) {\n            case IIIFResourceType.MANIFEST:\n                this.viewManifest(data);\n                break;\n            case IIIFResourceType.COLLECTION:\n                // note: this won't get called as the tree component now has branchNodesSelectable = false\n                // useful to keep around for reference\n                this.viewCollection(data);\n                break;\n            default:\n                this.viewRange(data.path);\n                break;\n        }\n    };\n    OpenSeadragonExtension.prototype.clearAnnotations = function () {\n        this.annotations = null;\n        // reload current index as it may contain results.\n        this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, this.helper.canvasIndex);\n    };\n    OpenSeadragonExtension.prototype.prevSearchResult = function () {\n        var foundResult;\n        if (!this.annotations)\n            return;\n        // get the first result with a canvasIndex less than the current index.\n        for (var i = this.annotations.length - 1; i >= 0; i--) {\n            var result = this.annotations[i];\n            if (result.canvasIndex <= this.getPrevPageIndex()) {\n                foundResult = result;\n                this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, foundResult.canvasIndex);\n                break;\n            }\n        }\n    };\n    OpenSeadragonExtension.prototype.nextSearchResult = function () {\n        if (!this.annotations)\n            return;\n        // get the first result with an index greater than the current index.\n        for (var i = 0; i < this.annotations.length; i++) {\n            var result = this.annotations[i];\n            if (result && result.canvasIndex >= this.getNextPageIndex()) {\n                this.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, result.canvasIndex);\n                break;\n            }\n        }\n    };\n    OpenSeadragonExtension.prototype.bookmark = function () {\n        _super.prototype.bookmark.call(this);\n        var canvas = this.helper.getCurrentCanvas();\n        var bookmark = new Bookmark();\n        bookmark.index = this.helper.canvasIndex;\n        bookmark.label = LanguageMap.getValue(canvas.getLabel());\n        bookmark.path = this.getCroppedImageUri(canvas, this.getViewer());\n        bookmark.thumb = canvas.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth);\n        bookmark.title = this.helper.getLabel();\n        bookmark.trackingLabel = window.trackingLabel;\n        bookmark.type = ExternalResourceType.IMAGE;\n        this.fire(BaseEvents.BOOKMARK, bookmark);\n    };\n    OpenSeadragonExtension.prototype.print = function () {\n        // var args: MultiSelectionArgs = new MultiSelectionArgs();\n        // args.manifestUri = this.helper.manifestUri;\n        // args.allCanvases = true;\n        // args.format = this.data.config.options.printMimeType;\n        // args.sequence = this.helper.getCurrentSequence().id;\n        window.print();\n        this.fire(Events.PRINT);\n    };\n    OpenSeadragonExtension.prototype.getCroppedImageDimensions = function (canvas, viewer) {\n        if (!viewer)\n            return null;\n        if (!viewer.viewport)\n            return null;\n        var resourceWidth;\n        var resourceHeight;\n        if (canvas.getWidth()) {\n            resourceWidth = canvas.getWidth();\n        }\n        else {\n            resourceWidth = canvas.externalResource.width;\n        }\n        if (canvas.getHeight()) {\n            resourceHeight = canvas.getHeight();\n        }\n        else {\n            resourceHeight = canvas.externalResource.height;\n        }\n        if (!resourceWidth || !resourceHeight) {\n            return null;\n        }\n        var bounds = viewer.viewport.getBounds(true);\n        var dimensions = new CroppedImageDimensions();\n        var width = Math.floor(bounds.width);\n        var height = Math.floor(bounds.height);\n        var x = Math.floor(bounds.x);\n        var y = Math.floor(bounds.y);\n        // constrain to image bounds\n        if (x + width > resourceWidth) {\n            width = resourceWidth - x;\n        }\n        else if (x < 0) {\n            width = width + x;\n        }\n        if (x < 0) {\n            x = 0;\n        }\n        if (y + height > resourceHeight) {\n            height = resourceHeight - y;\n        }\n        else if (y < 0) {\n            height = height + y;\n        }\n        if (y < 0) {\n            y = 0;\n        }\n        width = Math.min(width, resourceWidth);\n        height = Math.min(height, resourceHeight);\n        var regionWidth = width;\n        var regionHeight = height;\n        var maxDimensions = canvas.getMaxDimensions();\n        if (maxDimensions) {\n            if (width > maxDimensions.width) {\n                var newWidth = maxDimensions.width;\n                height = Math.round(newWidth * (height / width));\n                width = newWidth;\n            }\n            if (height > maxDimensions.height) {\n                var newHeight = maxDimensions.height;\n                width = Math.round((width / height) * newHeight);\n                height = newHeight;\n            }\n        }\n        dimensions.region = new Size(regionWidth, regionHeight);\n        dimensions.regionPos = new Point(x, y);\n        dimensions.size = new Size(width, height);\n        return dimensions;\n    };\n    // keep this around for reference\n    // getOnScreenCroppedImageDimensions(canvas: manifesto.Canvas, viewer: any): CroppedImageDimensions {\n    //     if (!viewer) return null;\n    //     if (!viewer.viewport) return null;\n    //     if (!canvas.getHeight() || !canvas.getWidth()){\n    //         return null;\n    //     }\n    //     var bounds = viewer.viewport.getBounds(true);\n    //     var containerSize = viewer.viewport.getContainerSize();\n    //     var zoom = viewer.viewport.getZoom(true);\n    //     var top = Math.max(0, bounds.y);\n    //     var left = Math.max(0, bounds.x);\n    //     // change top to be normalised value proportional to height of image, not width (as per OSD).\n    //     top = 1 / (canvas.getHeight() / parseInt(String(canvas.getWidth() * top)));\n    //     // get on-screen pixel sizes.\n    //     var viewportWidthPx = containerSize.x;\n    //     var viewportHeightPx = containerSize.y;\n    //     var imageWidthPx = parseInt(String(viewportWidthPx * zoom));\n    //     var ratio = canvas.getWidth() / imageWidthPx;\n    //     var imageHeightPx = parseInt(String(canvas.getHeight() / ratio));\n    //     var viewportLeftPx = parseInt(String(left * imageWidthPx));\n    //     var viewportTopPx = parseInt(String(top * imageHeightPx));\n    //     var rect1Left = 0;\n    //     var rect1Right = imageWidthPx;\n    //     var rect1Top = 0;\n    //     var rect1Bottom = imageHeightPx;\n    //     var rect2Left = viewportLeftPx;\n    //     var rect2Right = viewportLeftPx + viewportWidthPx;\n    //     var rect2Top = viewportTopPx;\n    //     var rect2Bottom = viewportTopPx + viewportHeightPx;\n    //     var sizeWidth = Math.max(0, Math.min(rect1Right, rect2Right) - Math.max(rect1Left, rect2Left));\n    //     var sizeHeight = Math.max(0, Math.min(rect1Bottom, rect2Bottom) - Math.max(rect1Top, rect2Top));\n    //     // get original image pixel sizes.\n    //     var ratio2 = canvas.getWidth() / imageWidthPx;\n    //     var regionWidth = parseInt(String(sizeWidth * ratio2));\n    //     var regionHeight = parseInt(String(sizeHeight * ratio2));\n    //     var regionTop = parseInt(String(canvas.getHeight() * top));\n    //     var regionLeft = parseInt(String(canvas.getWidth() * left));\n    //     if (regionTop < 0) regionTop = 0;\n    //     if (regionLeft < 0) regionLeft = 0;\n    //     var dimensions: CroppedImageDimensions = new CroppedImageDimensions();\n    //     dimensions.region = new manifesto.Size(regionWidth, regionHeight);\n    //     dimensions.regionPos = new Point(regionLeft, regionTop);\n    //     dimensions.size = new manifesto.Size(sizeWidth, sizeHeight);\n    //     return dimensions;\n    // }\n    OpenSeadragonExtension.prototype.getCroppedImageUri = function (canvas, viewer) {\n        if (!viewer)\n            return null;\n        if (!viewer.viewport)\n            return null;\n        var dimensions = this.getCroppedImageDimensions(canvas, viewer);\n        if (!dimensions) {\n            return null;\n        }\n        // construct uri\n        // {baseuri}/{id}/{region}/{size}/{rotation}/{quality}.jpg\n        var baseUri = this.getImageBaseUri(canvas);\n        var id = this.getImageId(canvas);\n        if (!id) {\n            return null;\n        }\n        var region = dimensions.regionPos.x +\n            \",\" +\n            dimensions.regionPos.y +\n            \",\" +\n            dimensions.region.width +\n            \",\" +\n            dimensions.region.height;\n        var size = dimensions.size.width + \",\" + dimensions.size.height;\n        var rotation = this.getViewerRotation();\n        var quality = \"default\";\n        return baseUri + \"/\" + id + \"/\" + region + \"/\" + size + \"/\" + rotation + \"/\" + quality + \".jpg\";\n    };\n    OpenSeadragonExtension.prototype.getConfinedImageDimensions = function (canvas, width) {\n        var resourceWidth = canvas.getWidth();\n        if (!resourceWidth) {\n            resourceWidth = canvas.externalResource.width;\n        }\n        var resourceHeight = canvas.getHeight();\n        if (!resourceHeight) {\n            resourceHeight = canvas.externalResource.height;\n        }\n        var dimensions = new Size(0, 0);\n        dimensions.width = width;\n        var normWidth = Maths.normalise(width, 0, resourceWidth);\n        dimensions.height = Math.floor(resourceHeight * normWidth);\n        return dimensions;\n    };\n    OpenSeadragonExtension.prototype.getConfinedImageUri = function (canvas, width) {\n        var baseUri = this.getImageBaseUri(canvas);\n        // {baseuri}/{id}/{region}/{size}/{rotation}/{quality}.jpg\n        var id = this.getImageId(canvas);\n        if (!id) {\n            return null;\n        }\n        var region = \"full\";\n        var dimensions = this.getConfinedImageDimensions(canvas, width);\n        var size = dimensions.width + \",\" + dimensions.height;\n        var rotation = this.getViewerRotation();\n        var quality = \"default\";\n        return baseUri + \"/\" + id + \"/\" + region + \"/\" + size + \"/\" + rotation + \"/\" + quality + \".jpg\";\n    };\n    OpenSeadragonExtension.prototype.getImageId = function (canvas) {\n        if (canvas.externalResource) {\n            var id = canvas.externalResource.data[\"@id\"];\n            if (id) {\n                return id.substr(id.lastIndexOf(\"/\") + 1);\n            }\n        }\n        return null;\n    };\n    OpenSeadragonExtension.prototype.getImageBaseUri = function (canvas) {\n        var uri = this.getInfoUri(canvas);\n        // First trim off info.json, then trim off ID....\n        uri = uri.substr(0, uri.lastIndexOf(\"/\"));\n        return uri.substr(0, uri.lastIndexOf(\"/\"));\n    };\n    OpenSeadragonExtension.prototype.getInfoUri = function (canvas) {\n        var infoUri = null;\n        var images = canvas.getImages();\n        // presentation 2\n        if (images && images.length) {\n            var firstImage = images[0];\n            var resource = firstImage.getResource();\n            var services = resource.getServices();\n            for (var i = 0; i < services.length; i++) {\n                var service = services[i];\n                var id = service.id;\n                if (!id.endsWith(\"/\")) {\n                    id += \"/\";\n                }\n                if (Utils.isImageProfile(service.getProfile())) {\n                    infoUri = id + \"info.json\";\n                }\n            }\n        }\n        else {\n            // presentation 3\n            images = canvas.getContent();\n            var firstImage = images[0];\n            var body = firstImage.getBody();\n            if (body.length) {\n                var services = body[0].getServices();\n                for (var i = 0; i < services.length; i++) {\n                    var service = services[i];\n                    var id = service.id;\n                    if (!id.endsWith(\"/\")) {\n                        id += \"/\";\n                    }\n                    if (Utils.isImageProfile(service.getProfile())) {\n                        infoUri = id + \"info.json\";\n                    }\n                }\n            }\n        }\n        if (!infoUri) {\n            // todo: use compiler flag (when available)\n            infoUri = \"lib/imageunavailable.json\";\n        }\n        return infoUri;\n    };\n    OpenSeadragonExtension.prototype.getEmbedScript = function (template, width, height, zoom, rotation) {\n        var config = this.data.config.uri || \"\";\n        var locales = this.getSerializedLocales();\n        var appUri = this.getAppUri();\n        var iframeSrc = appUri + \"#?manifest=\" + this.helper.manifestUri + \"&c=\" + this.helper.collectionIndex + \"&m=\" + this.helper.manifestIndex + \"&s=\" + this.helper.sequenceIndex + \"&cv=\" + this.helper.canvasIndex + \"&config=\" + config + \"&locales=\" + locales + \"&xywh=\" + zoom + \"&r=\" + rotation;\n        var script = Strings.format(template, iframeSrc, width.toString(), height.toString());\n        return script;\n    };\n    OpenSeadragonExtension.prototype.getPrevPageIndex = function (canvasIndex) {\n        if (canvasIndex === void 0) { canvasIndex = this.helper.canvasIndex; }\n        var index;\n        if (this.isPagingSettingEnabled()) {\n            var indices = this.getPagedIndices(canvasIndex);\n            if (this.helper.isRightToLeft()) {\n                index = indices[indices.length - 1] - 1;\n            }\n            else {\n                index = indices[0] - 1;\n            }\n        }\n        else {\n            index = canvasIndex - 1;\n        }\n        return index;\n    };\n    OpenSeadragonExtension.prototype.isSearchEnabled = function () {\n        if (!Bools.getBool(this.data.config.options.searchWithinEnabled, false)) {\n            return false;\n        }\n        if (!this.helper.getSearchService()) {\n            return false;\n        }\n        return true;\n    };\n    OpenSeadragonExtension.prototype.isPagingSettingEnabled = function () {\n        if (this.helper.isPagingAvailable()) {\n            return this.getSettings().pagingEnabled;\n        }\n        return false;\n    };\n    OpenSeadragonExtension.prototype.getNextPageIndex = function (canvasIndex) {\n        if (canvasIndex === void 0) { canvasIndex = this.helper.canvasIndex; }\n        var index;\n        if (this.isPagingSettingEnabled()) {\n            var indices = this.getPagedIndices(canvasIndex);\n            if (this.helper.isRightToLeft()) {\n                index = indices[0] + 1;\n            }\n            else {\n                index = indices[indices.length - 1] + 1;\n            }\n        }\n        else {\n            index = canvasIndex + 1;\n        }\n        if (index > this.helper.getTotalCanvases() - 1) {\n            return -1;\n        }\n        return index;\n    };\n    OpenSeadragonExtension.prototype.getAutoCompleteService = function () {\n        var service = this.helper.getSearchService();\n        if (!service)\n            return null;\n        return (service.getService(ServiceProfile.SEARCH_0_AUTO_COMPLETE) ||\n            service.getService(ServiceProfile.SEARCH_1_AUTO_COMPLETE));\n    };\n    OpenSeadragonExtension.prototype.getAutoCompleteUri = function () {\n        var service = this.getAutoCompleteService();\n        if (!service)\n            return null;\n        return service.id + \"?q={0}\";\n    };\n    OpenSeadragonExtension.prototype.getSearchServiceUri = function () {\n        var service = this.helper.getSearchService();\n        if (!service)\n            return null;\n        var uri = service.id;\n        uri = uri + \"?q={0}\";\n        return uri;\n    };\n    OpenSeadragonExtension.prototype.search = function (terms) {\n        var _this = this;\n        if (this.isAnnotating)\n            return;\n        this.isAnnotating = true;\n        // clear search results\n        this.annotations = [];\n        var that = this;\n        // searching\n        var searchUri = this.getSearchServiceUri();\n        if (!searchUri)\n            return;\n        searchUri = Strings.format(searchUri, encodeURIComponent(terms));\n        this.getSearchResults(searchUri, terms, this.annotations, function (annotations) {\n            that.isAnnotating = false;\n            if (annotations.length) {\n                that.annotate(annotations, terms);\n            }\n            else {\n                that.showMessage(that.data.config.modules.genericDialogue.content.noMatches, function () {\n                    _this.component.publish(BaseEvents.ANNOTATIONS_EMPTY);\n                });\n            }\n        });\n    };\n    OpenSeadragonExtension.prototype.getSearchResults = function (searchUri, terms, searchResults, cb) {\n        var _this = this;\n        $.getJSON(searchUri, function (results) {\n            if (results.resources && results.resources.length) {\n                searchResults = searchResults.concat(_this.parseAnnotationList(results));\n            }\n            if (results.next) {\n                _this.getSearchResults(results.next, terms, searchResults, cb);\n            }\n            else {\n                cb(searchResults);\n            }\n        });\n    };\n    OpenSeadragonExtension.prototype.parseAnnotationList = function (annotations) {\n        var parsed = [];\n        var _loop_1 = function (i) {\n            var resource = annotations.resources[i];\n            var canvasIndex = this_1.helper.getCanvasIndexById(resource.on.match(/(.*)#/)[1]);\n            var annotationGroup = new AnnotationGroup(resource, canvasIndex);\n            var match = parsed.filter(function (x) { return x.canvasIndex === annotationGroup.canvasIndex; })[0];\n            // if there's already an annotation for the canvas index, add a rect to it, otherwise create a new AnnotationGroup\n            if (match) {\n                match.addRect(resource);\n            }\n            else {\n                parsed.push(annotationGroup);\n            }\n        };\n        var this_1 = this;\n        for (var i = 0; i < annotations.resources.length; i++) {\n            _loop_1(i);\n        }\n        // sort by canvasIndex\n        parsed.sort(function (a, b) {\n            return a.canvasIndex - b.canvasIndex;\n        });\n        return parsed;\n    };\n    OpenSeadragonExtension.prototype.getAnnotationRects = function () {\n        if (this.annotations) {\n            return this.annotations\n                .map(function (x) {\n                return x.rects;\n            })\n                .reduce(function (a, b) {\n                return a.concat(b);\n            });\n        }\n        return [];\n    };\n    OpenSeadragonExtension.prototype.getCurrentAnnotationRectIndex = function () {\n        var annotationRects = this.getAnnotationRects();\n        if (this.currentAnnotationRect) {\n            return annotationRects.indexOf(this.currentAnnotationRect);\n        }\n        return -1;\n    };\n    OpenSeadragonExtension.prototype.getTotalAnnotationRects = function () {\n        var annotationRects = this.getAnnotationRects();\n        return annotationRects.length;\n    };\n    OpenSeadragonExtension.prototype.isFirstAnnotationRect = function () {\n        return this.getCurrentAnnotationRectIndex() === 0;\n    };\n    OpenSeadragonExtension.prototype.getLastAnnotationRectIndex = function () {\n        return this.getTotalAnnotationRects() - 1;\n    };\n    OpenSeadragonExtension.prototype.getPagedIndices = function (canvasIndex) {\n        if (canvasIndex === void 0) { canvasIndex = this.helper.canvasIndex; }\n        var indices = [];\n        // if it's a continuous manifest, get all resources.\n        if (this.helper.isContinuous()) {\n            indices = $.map(this.helper.getCanvases(), function (c, index) {\n                return index;\n            });\n        }\n        else {\n            if (!this.isPagingSettingEnabled()) {\n                indices.push(this.helper.canvasIndex);\n            }\n            else {\n                if (this.helper.isFirstCanvas(canvasIndex) ||\n                    (this.helper.isLastCanvas(canvasIndex) &&\n                        this.helper.isTotalCanvasesEven())) {\n                    indices = [canvasIndex];\n                }\n                else if (canvasIndex % 2) {\n                    indices = [canvasIndex, canvasIndex + 1];\n                }\n                else {\n                    indices = [canvasIndex - 1, canvasIndex];\n                }\n                if (this.helper.isRightToLeft()) {\n                    indices = indices.reverse();\n                }\n            }\n        }\n        return indices;\n    };\n    return OpenSeadragonExtension;\n}(BaseExtension));\nexport default OpenSeadragonExtension;\n","var MultiSelectionArgs = /** @class */ (function () {\n    function MultiSelectionArgs() {\n    }\n    return MultiSelectionArgs;\n}());\nexport { MultiSelectionArgs };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { SettingsDialogue as BaseSettingsDialogue } from \"../../modules/uv-dialogues-module/SettingsDialogue\";\nvar SettingsDialogue = /** @class */ (function (_super) {\n    __extends(SettingsDialogue, _super);\n    function SettingsDialogue($element) {\n        return _super.call(this, $element) || this;\n    }\n    SettingsDialogue.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"settingsDialogue\");\n        _super.prototype.create.call(this);\n        this.$navigatorEnabled = $('<div class=\"setting navigatorEnabled\"></div>');\n        this.$scroll.append(this.$navigatorEnabled);\n        // todo: use .checkboxButton jquery extension\n        this.$navigatorEnabledCheckbox = $('<input id=\"navigatorEnabled\" type=\"checkbox\" tabindex=\"0\" />');\n        this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox);\n        this.$navigatorEnabledLabel = $('<label for=\"navigatorEnabled\">' +\n            this.content.navigatorEnabled +\n            \"</label>\");\n        this.$navigatorEnabled.append(this.$navigatorEnabledLabel);\n        this.$pagingEnabled = $('<div class=\"setting pagingEnabled\"></div>');\n        this.$scroll.append(this.$pagingEnabled);\n        this.$pagingEnabledCheckbox = $('<input id=\"pagingEnabled\" type=\"checkbox\" tabindex=\"0\" />');\n        this.$pagingEnabled.append(this.$pagingEnabledCheckbox);\n        this.$pagingEnabledLabel = $('<label for=\"pagingEnabled\">' + this.content.pagingEnabled + \"</label>\");\n        this.$pagingEnabled.append(this.$pagingEnabledLabel);\n        this.$clickToZoomEnabled = $('<div class=\"setting clickToZoom\"></div>');\n        this.$scroll.append(this.$clickToZoomEnabled);\n        this.$clickToZoomEnabledCheckbox = $('<input id=\"clickToZoomEnabled\" type=\"checkbox\" />');\n        this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox);\n        this.$clickToZoomEnabledLabel = $('<label for=\"clickToZoomEnabled\">' +\n            this.content.clickToZoomEnabled +\n            \"</label>\");\n        this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel);\n        this.$preserveViewport = $('<div class=\"setting preserveViewport\"></div>');\n        this.$scroll.append(this.$preserveViewport);\n        this.$preserveViewportCheckbox = $('<input id=\"preserveViewport\" type=\"checkbox\" tabindex=\"0\" />');\n        this.$preserveViewport.append(this.$preserveViewportCheckbox);\n        this.$preserveViewportLabel = $('<label for=\"preserveViewport\">' +\n            this.content.preserveViewport +\n            \"</label>\");\n        this.$preserveViewport.append(this.$preserveViewportLabel);\n        this.$navigatorEnabledCheckbox.change(function () {\n            var settings = {};\n            if (_this.$navigatorEnabledCheckbox.is(\":checked\")) {\n                settings.navigatorEnabled = true;\n            }\n            else {\n                settings.navigatorEnabled = false;\n            }\n            _this.updateSettings(settings);\n        });\n        this.$clickToZoomEnabledCheckbox.change(function () {\n            var settings = {};\n            if (_this.$clickToZoomEnabledCheckbox.is(\":checked\")) {\n                settings.clickToZoomEnabled = true;\n            }\n            else {\n                settings.clickToZoomEnabled = false;\n            }\n            _this.updateSettings(settings);\n        });\n        this.$pagingEnabledCheckbox.change(function () {\n            var settings = {};\n            if (_this.$pagingEnabledCheckbox.is(\":checked\")) {\n                settings.pagingEnabled = true;\n            }\n            else {\n                settings.pagingEnabled = false;\n            }\n            _this.updateSettings(settings);\n        });\n        this.$preserveViewportCheckbox.change(function () {\n            var settings = {};\n            if (_this.$preserveViewportCheckbox.is(\":checked\")) {\n                settings.preserveViewport = true;\n            }\n            else {\n                settings.preserveViewport = false;\n            }\n            _this.updateSettings(settings);\n        });\n    };\n    SettingsDialogue.prototype.open = function () {\n        _super.prototype.open.call(this);\n        var settings = this.getSettings();\n        if (settings.navigatorEnabled) {\n            this.$navigatorEnabledCheckbox.prop(\"checked\", true);\n        }\n        else {\n            this.$navigatorEnabledCheckbox.removeAttr(\"checked\");\n        }\n        if (settings.clickToZoomEnabled) {\n            this.$clickToZoomEnabledCheckbox.prop(\"checked\", true);\n        }\n        else {\n            this.$clickToZoomEnabledCheckbox.removeAttr(\"checked\");\n        }\n        if (!this.extension.helper.isPagingAvailable()) {\n            this.$pagingEnabled.hide();\n        }\n        else {\n            if (settings.pagingEnabled) {\n                this.$pagingEnabledCheckbox.prop(\"checked\", true);\n            }\n            else {\n                this.$pagingEnabledCheckbox.removeAttr(\"checked\");\n            }\n        }\n        if (settings.preserveViewport) {\n            this.$preserveViewportCheckbox.prop(\"checked\", true);\n        }\n        else {\n            this.$preserveViewportCheckbox.removeAttr(\"checked\");\n        }\n    };\n    return SettingsDialogue;\n}(BaseSettingsDialogue));\nexport { SettingsDialogue };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Events } from \"./Events\";\nimport { ShareDialogue as BaseShareDialogue } from \"../../modules/uv-dialogues-module/ShareDialogue\";\nvar ShareDialogue = /** @class */ (function (_super) {\n    __extends(ShareDialogue, _super);\n    function ShareDialogue($element) {\n        var _this = _super.call(this, $element) || this;\n        _this.component.subscribe(Events.OPENSEADRAGON_OPEN, function () {\n            _this.update();\n        });\n        _this.component.subscribe(Events.OPENSEADRAGON_ANIMATION_FINISH, function () {\n            _this.update();\n        });\n        return _this;\n    }\n    ShareDialogue.prototype.create = function () {\n        this.setConfig(\"shareDialogue\");\n        _super.prototype.create.call(this);\n    };\n    ShareDialogue.prototype.update = function () {\n        _super.prototype.update.call(this);\n        var xywh = (this.extension.getViewportBounds());\n        var rotation = (this.extension.getViewerRotation());\n        this.code = this.extension.getEmbedScript(this.options.embedTemplate, this.currentWidth, this.currentHeight, xywh, rotation);\n        this.$code.val(this.code);\n    };\n    ShareDialogue.prototype.resize = function () {\n        _super.prototype.resize.call(this);\n    };\n    return ShareDialogue;\n}(BaseShareDialogue));\nexport { ShareDialogue };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { BaseEvents } from \"../uv-shared-module/BaseEvents\";\nimport { Dialogue } from \"../uv-shared-module/Dialogue\";\nvar ExternalContentDialogue = /** @class */ (function (_super) {\n    __extends(ExternalContentDialogue, _super);\n    function ExternalContentDialogue($element) {\n        return _super.call(this, $element) || this;\n    }\n    ExternalContentDialogue.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"externalContentDialogue\");\n        _super.prototype.create.call(this);\n        this.openCommand = BaseEvents.SHOW_EXTERNALCONTENT_DIALOGUE;\n        this.closeCommand = BaseEvents.HIDE_EXTERNALCONTENT_DIALOGUE;\n        this.component.subscribe(this.openCommand, function (params) {\n            _this.open();\n            _this.$iframe.prop(\"src\", params.uri);\n        });\n        this.component.subscribe(this.closeCommand, function () {\n            _this.close();\n        });\n        this.$iframe = $(\"<iframe></iframe>\");\n        this.$content.append(this.$iframe);\n        this.$element.hide();\n    };\n    ExternalContentDialogue.prototype.resize = function () {\n        _super.prototype.resize.call(this);\n        this.$iframe.width(this.$content.width());\n        this.$iframe.height(this.$content.height());\n    };\n    return ExternalContentDialogue;\n}(Dialogue));\nexport { ExternalContentDialogue };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { BaseEvents } from \"../uv-shared-module/BaseEvents\";\nimport { Dialogue } from \"../uv-shared-module/Dialogue\";\nvar HelpDialogue = /** @class */ (function (_super) {\n    __extends(HelpDialogue, _super);\n    function HelpDialogue($element) {\n        return _super.call(this, $element) || this;\n    }\n    HelpDialogue.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"helpDialogue\");\n        _super.prototype.create.call(this);\n        this.openCommand = BaseEvents.SHOW_HELP_DIALOGUE;\n        this.closeCommand = BaseEvents.HIDE_HELP_DIALOGUE;\n        this.component.subscribe(this.openCommand, function () {\n            _this.open();\n        });\n        this.component.subscribe(this.closeCommand, function () {\n            _this.close();\n        });\n        this.$title = $(\"<h1></h1>\");\n        this.$content.append(this.$title);\n        this.$scroll = $('<div class=\"scroll\"></div>');\n        this.$content.append(this.$scroll);\n        this.$message = $(\"<p></p>\");\n        this.$scroll.append(this.$message);\n        // initialise ui.\n        this.$title.text(this.content.title);\n        this.$message.html(this.content.text);\n        // ensure anchor tags link to _blank.\n        this.$message.targetBlank();\n        this.$element.hide();\n    };\n    HelpDialogue.prototype.resize = function () {\n        _super.prototype.resize.call(this);\n    };\n    return HelpDialogue;\n}(Dialogue));\nexport { HelpDialogue };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { BaseEvents } from \"../../modules/uv-shared-module/BaseEvents\";\nimport { Dialogue } from \"../../modules/uv-shared-module/Dialogue\";\nimport { Mode } from \"../../extensions/uv-openseadragon-extension/Mode\";\nimport { Bools } from \"@edsilv/utils\";\nimport { GalleryComponent } from \"@iiif/iiif-gallery-component\";\nvar MultiSelectDialogue = /** @class */ (function (_super) {\n    __extends(MultiSelectDialogue, _super);\n    function MultiSelectDialogue($element) {\n        return _super.call(this, $element) || this;\n    }\n    MultiSelectDialogue.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"multiSelectDialogue\");\n        _super.prototype.create.call(this);\n        var that = this;\n        this.openCommand = BaseEvents.SHOW_MULTISELECT_DIALOGUE;\n        this.closeCommand = BaseEvents.HIDE_MULTISELECT_DIALOGUE;\n        this.component.subscribe(this.openCommand, function () {\n            _this.open();\n            var multiSelectState = _this.extension.helper.getMultiSelectState();\n            multiSelectState.setEnabled(true);\n            _this.galleryComponent.set(_this.data);\n        });\n        this.component.subscribe(this.closeCommand, function () {\n            _this.close();\n            var multiSelectState = _this.extension.helper.getMultiSelectState();\n            multiSelectState.setEnabled(false);\n        });\n        this.$title = $(\"<h1></h1>\");\n        this.$content.append(this.$title);\n        this.$title.text(this.content.title);\n        this.$gallery = $('<div class=\"iiif-gallery-component\"></div>');\n        this.$content.append(this.$gallery);\n        this.data = {\n            helper: this.extension.helper,\n            chunkedResizingThreshold: this.config.options\n                .galleryThumbChunkedResizingThreshold,\n            content: this.config.content,\n            debug: false,\n            imageFadeInDuration: 300,\n            initialZoom: 4,\n            minLabelWidth: 20,\n            pageModeEnabled: this.isPageModeEnabled(),\n            searchResults: [],\n            scrollStopDuration: 100,\n            sizingEnabled: true,\n            thumbHeight: this.config.options.galleryThumbHeight,\n            thumbLoadPadding: this.config.options.galleryThumbLoadPadding,\n            thumbWidth: this.config.options.galleryThumbWidth,\n            viewingDirection: this.extension.helper.getViewingDirection()\n        };\n        this.galleryComponent = new GalleryComponent({\n            target: this.$gallery[0]\n        });\n        var $selectButton = this.$gallery.find(\"a.select\");\n        $selectButton.addClass(\"btn btn-primary\");\n        this.galleryComponent.on(\"multiSelectionMade\", function (ids) {\n            _this.component.publish(BaseEvents.MULTISELECTION_MADE, ids);\n            that.close();\n        }, false);\n        this.$element.hide();\n    };\n    MultiSelectDialogue.prototype.isPageModeEnabled = function () {\n        return (Bools.getBool(this.config.options.pageModeEnabled, true) &&\n            this.extension.getMode().toString() ===\n                Mode.page.toString());\n    };\n    MultiSelectDialogue.prototype.open = function () {\n        _super.prototype.open.call(this);\n    };\n    MultiSelectDialogue.prototype.close = function () {\n        _super.prototype.close.call(this);\n    };\n    MultiSelectDialogue.prototype.resize = function () {\n        _super.prototype.resize.call(this);\n        var $main = this.$gallery.find(\".main\");\n        var $header = this.$gallery.find(\".header\");\n        $main.height(this.$content.height() -\n            this.$title.outerHeight() -\n            this.$title.verticalMargins() -\n            $header.height());\n    };\n    return MultiSelectDialogue;\n}(Dialogue));\nexport { MultiSelectDialogue };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { Async, Bools, Dimensions } from \"@edsilv/utils\";\nimport { sanitize } from \"../../Utils\";\nimport { ViewingDirection } from \"@iiif/vocabulary\";\nimport { BaseEvents } from \"../uv-shared-module/BaseEvents\";\nimport { Bounds } from \"../../extensions/uv-openseadragon-extension/Bounds\";\nimport { CenterPanel } from \"../uv-shared-module/CenterPanel\";\nimport { Events } from \"../../extensions/uv-openseadragon-extension/Events\";\nimport OpenSeadragon from \"openseadragon\";\nvar OpenSeadragonCenterPanel = /** @class */ (function (_super) {\n    __extends(OpenSeadragonCenterPanel, _super);\n    function OpenSeadragonCenterPanel($element) {\n        var _this = _super.call(this, $element) || this;\n        _this.controlsVisible = false;\n        _this.isCreated = false;\n        _this.isFirstLoad = true;\n        _this.navigatedFromSearch = false;\n        _this.nextButtonEnabled = false;\n        _this.prevButtonEnabled = false;\n        return _this;\n    }\n    OpenSeadragonCenterPanel.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"openSeadragonCenterPanel\");\n        _super.prototype.create.call(this);\n        this.viewerId = \"osd\" + new Date().getTime();\n        this.$viewer = $('<div id=\"' + this.viewerId + '\" class=\"viewer\"></div>');\n        this.$content.prepend(this.$viewer);\n        this.component.subscribe(BaseEvents.ANNOTATIONS, function (args) {\n            _this.overlayAnnotations();\n            _this.zoomToInitialAnnotation();\n        });\n        this.component.subscribe(BaseEvents.SETTINGS_CHANGED, function (args) {\n            _this.viewer.gestureSettingsMouse.clickToZoom = args.clickToZoomEnabled;\n        });\n        this.component.subscribe(BaseEvents.OPEN_EXTERNAL_RESOURCE, function (resources) {\n            _this.whenResized(function () { return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            if (!this.isCreated)\n                                this.createUI();\n                            return [4 /*yield*/, this.openMedia(resources)];\n                        case 1:\n                            _a.sent();\n                            this.component.publish(BaseEvents.OPENED_MEDIA);\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n        });\n        this.component.subscribe(BaseEvents.CLEAR_ANNOTATIONS, function () {\n            _this.whenCreated(function () {\n                _this.extension.currentAnnotationRect = null;\n                _this.clearAnnotations();\n            });\n        });\n        this.component.subscribe(Events.NEXT_SEARCH_RESULT, function () {\n            _this.whenCreated(function () {\n                _this.nextAnnotation();\n            });\n        });\n        this.component.subscribe(Events.PREV_SEARCH_RESULT, function () {\n            _this.whenCreated(function () {\n                _this.prevAnnotation();\n            });\n        });\n        this.component.subscribe(Events.ZOOM_IN, function () {\n            _this.whenCreated(function () {\n                _this.zoomIn();\n            });\n        });\n        this.component.subscribe(Events.ZOOM_OUT, function () {\n            _this.whenCreated(function () {\n                _this.zoomOut();\n            });\n        });\n        this.component.subscribe(Events.ROTATE, function () {\n            _this.whenCreated(function () {\n                _this.rotateRight();\n            });\n        });\n        this.component.subscribe(BaseEvents.METRIC_CHANGED, function () {\n            _this.whenCreated(function () {\n                _this.updateResponsiveView();\n            });\n        });\n    };\n    OpenSeadragonCenterPanel.prototype.whenCreated = function (cb) {\n        var _this = this;\n        Async.waitFor(function () {\n            return _this.isCreated;\n        }, cb);\n    };\n    OpenSeadragonCenterPanel.prototype.zoomIn = function () {\n        this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(true) * 2);\n    };\n    OpenSeadragonCenterPanel.prototype.zoomOut = function () {\n        this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(true) * 0.5);\n    };\n    OpenSeadragonCenterPanel.prototype.rotateRight = function () {\n        this.viewer.viewport.setRotation(this.viewer.viewport.getRotation() + 90);\n    };\n    OpenSeadragonCenterPanel.prototype.updateResponsiveView = function () {\n        this.setNavigatorVisible();\n        if (!this.extension.isDesktopMetric()) {\n            this.viewer.autoHideControls = false;\n            this.$viewportNavButtons.hide();\n        }\n        else {\n            this.viewer.autoHideControls = true;\n            this.$viewportNavButtons.show();\n        }\n    };\n    OpenSeadragonCenterPanel.prototype.createUI = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                this.$spinner = $('<div class=\"spinner\"></div>');\n                this.$content.append(this.$spinner);\n                //await import(/* webpackChunkName: \"openseadragon\" *//* webpackMode: \"eager\" */ \"openseadragon\");\n                this.viewer = OpenSeadragon({\n                    id: this.viewerId,\n                    crossOriginPolicy: \"Anonymous\",\n                    showNavigationControl: true,\n                    showNavigator: true,\n                    showRotationControl: true,\n                    showHomeControl: Bools.getBool(this.config.options.showHomeControl, false),\n                    showFullPageControl: false,\n                    defaultZoomLevel: this.config.options.defaultZoomLevel || 0,\n                    maxZoomPixelRatio: this.config.options.maxZoomPixelRatio || 2,\n                    controlsFadeDelay: this.config.options.controlsFadeDelay || 250,\n                    controlsFadeLength: this.config.options.controlsFadeLength || 250,\n                    navigatorPosition: this.config.options.navigatorPosition || \"BOTTOM_RIGHT\",\n                    navigatorHeight: \"100px\",\n                    navigatorWidth: \"100px\",\n                    animationTime: this.config.options.animationTime || 1.2,\n                    visibilityRatio: this.config.options.visibilityRatio || 0.5,\n                    constrainDuringPan: Bools.getBool(this.config.options.constrainDuringPan, false),\n                    immediateRender: Bools.getBool(this.config.options.immediateRender, false),\n                    blendTime: this.config.options.blendTime || 0,\n                    autoHideControls: Bools.getBool(this.config.options.autoHideControls, true),\n                    prefixUrl: this.extension.data.assetsDir + \"/img/\",\n                    gestureSettingsMouse: {\n                        clickToZoom: Bools.getBool(this.extension.data.config.options.clickToZoomEnabled, true)\n                    },\n                    navImages: {\n                        zoomIn: {\n                            REST: \"pixel.gif\",\n                            GROUP: \"pixel.gif\",\n                            HOVER: \"pixel.gif\",\n                            DOWN: \"pixel.gif\"\n                        },\n                        zoomOut: {\n                            REST: \"pixel.gif\",\n                            GROUP: \"pixel.gif\",\n                            HOVER: \"pixel.gif\",\n                            DOWN: \"pixel.gif\"\n                        },\n                        home: {\n                            REST: \"pixel.gif\",\n                            GROUP: \"pixel.gif\",\n                            HOVER: \"pixel.gif\",\n                            DOWN: \"pixel.gif\"\n                        },\n                        rotateright: {\n                            REST: \"pixel.gif\",\n                            GROUP: \"pixel.gif\",\n                            HOVER: \"pixel.gif\",\n                            DOWN: \"pixel.gif\"\n                        },\n                        rotateleft: {\n                            REST: \"pixel.gif\",\n                            GROUP: \"pixel.gif\",\n                            HOVER: \"pixel.gif\",\n                            DOWN: \"pixel.gif\"\n                        },\n                        next: {\n                            REST: \"pixel.gif\",\n                            GROUP: \"pixel.gif\",\n                            HOVER: \"pixel.gif\",\n                            DOWN: \"pixel.gif\"\n                        },\n                        previous: {\n                            REST: \"pixel.gif\",\n                            GROUP: \"pixel.gif\",\n                            HOVER: \"pixel.gif\",\n                            DOWN: \"pixel.gif\"\n                        }\n                    }\n                });\n                this.$zoomInButton = this.$viewer.find('div[title=\"Zoom in\"]');\n                this.$zoomInButton.attr(\"tabindex\", 0);\n                this.$zoomInButton.prop(\"title\", this.content.zoomIn);\n                this.$zoomInButton.addClass(\"zoomIn viewportNavButton\");\n                this.$zoomOutButton = this.$viewer.find('div[title=\"Zoom out\"]');\n                this.$zoomOutButton.attr(\"tabindex\", 0);\n                this.$zoomOutButton.prop(\"title\", this.content.zoomOut);\n                this.$zoomOutButton.addClass(\"zoomOut viewportNavButton\");\n                this.$goHomeButton = this.$viewer.find('div[title=\"Go home\"]');\n                this.$goHomeButton.attr(\"tabindex\", 0);\n                this.$goHomeButton.prop(\"title\", this.content.goHome);\n                this.$goHomeButton.addClass(\"goHome viewportNavButton\");\n                this.$rotateButton = this.$viewer.find('div[title=\"Rotate right\"]');\n                this.$rotateButton.attr(\"tabindex\", 0);\n                this.$rotateButton.prop(\"title\", this.content.rotateRight);\n                this.$rotateButton.addClass(\"rotate viewportNavButton\");\n                this.$viewportNavButtonsContainer = this.$viewer.find(\".openseadragon-container > div:not(.openseadragon-canvas):first\");\n                this.$viewportNavButtons = this.$viewportNavButtonsContainer.find(\".viewportNavButton\");\n                this.$canvas = $(this.viewer.canvas);\n                // disable right click on canvas\n                this.$canvas.on(\"contextmenu\", function () {\n                    return false;\n                });\n                this.$navigator = this.$viewer.find(\".navigator\");\n                this.setNavigatorVisible();\n                // events\n                this.$element.on(\"mousemove\", function () {\n                    if (_this.controlsVisible)\n                        return;\n                    _this.controlsVisible = true;\n                    _this.viewer.setControlsEnabled(true);\n                });\n                this.$element.on(\"mouseleave\", function () {\n                    if (!_this.controlsVisible)\n                        return;\n                    _this.controlsVisible = false;\n                    _this.viewer.setControlsEnabled(false);\n                });\n                // when mouse move stopped\n                this.$element.on(\"mousemove\", function () {\n                    // if over element, hide controls.\n                    // When over prev/next buttons keep controls enabled\n                    if (_this.$prevButton.ismouseover()) {\n                        return;\n                    }\n                    if (_this.$nextButton.ismouseover()) {\n                        return;\n                    }\n                    if (!_this.$viewer.find(\".navigator\").ismouseover()) {\n                        if (!_this.controlsVisible)\n                            return;\n                        _this.controlsVisible = false;\n                        _this.viewer.setControlsEnabled(false);\n                    }\n                }, this.config.options.controlsFadeAfterInactive);\n                this.viewer.addHandler(\"tile-drawn\", function () {\n                    _this.$spinner.hide();\n                });\n                //this.viewer.addHandler(\"open-failed\", () => {\n                //});\n                this.viewer.addHandler(\"resize\", function (viewer) {\n                    _this.component.publish(Events.OPENSEADRAGON_RESIZE, viewer);\n                    _this.viewerResize(viewer);\n                });\n                this.viewer.addHandler(\"animation-start\", function (viewer) {\n                    _this.component.publish(Events.OPENSEADRAGON_ANIMATION_START, viewer);\n                });\n                this.viewer.addHandler(\"animation\", function (viewer) {\n                    _this.component.publish(Events.OPENSEADRAGON_ANIMATION, viewer);\n                });\n                this.viewer.addHandler(\"animation-finish\", function (viewer) {\n                    _this.currentBounds = _this.getViewportBounds();\n                    _this.updateVisibleAnnotationRects();\n                    _this.component.publish(Events.OPENSEADRAGON_ANIMATION_FINISH, viewer);\n                });\n                this.viewer.addHandler(\"rotate\", function (args) {\n                    _this.component.publish(Events.OPENSEADRAGON_ROTATION, args.degrees);\n                });\n                this.title = this.extension.helper.getLabel();\n                this.createNavigationButtons();\n                this.hidePrevButton();\n                this.hideNextButton();\n                this.isCreated = true;\n                return [2 /*return*/];\n            });\n        });\n    };\n    OpenSeadragonCenterPanel.prototype.createNavigationButtons = function () {\n        var _this = this;\n        var viewingDirection = this.extension.helper.getViewingDirection() ||\n            ViewingDirection.LEFT_TO_RIGHT;\n        this.$prevButton = $('<div class=\"paging btn prev\" tabindex=\"0\"></div>');\n        if (this.extension.helper.isRightToLeft()) {\n            this.$prevButton.prop(\"title\", this.content.next);\n        }\n        else {\n            this.$prevButton.prop(\"title\", this.content.previous);\n        }\n        this.$nextButton = $('<div class=\"paging btn next\" tabindex=\"0\"></div>');\n        if (this.extension.helper.isRightToLeft()) {\n            this.$nextButton.prop(\"title\", this.content.previous);\n        }\n        else {\n            this.$nextButton.prop(\"title\", this.content.next);\n        }\n        this.viewer.addControl(this.$prevButton[0], {\n            anchor: OpenSeadragon.ControlAnchor.TOP_LEFT\n        });\n        this.viewer.addControl(this.$nextButton[0], {\n            anchor: OpenSeadragon.ControlAnchor.TOP_RIGHT\n        });\n        switch (viewingDirection) {\n            case ViewingDirection.BOTTOM_TO_TOP:\n            case ViewingDirection.TOP_TO_BOTTOM:\n                this.$prevButton.addClass(\"vertical\");\n                this.$nextButton.addClass(\"vertical\");\n                break;\n        }\n        var that = this;\n        this.$prevButton.onPressed(function (e) {\n            e.preventDefault();\n            OpenSeadragon.cancelEvent(e);\n            if (!that.prevButtonEnabled)\n                return;\n            switch (viewingDirection) {\n                case ViewingDirection.LEFT_TO_RIGHT:\n                case ViewingDirection.BOTTOM_TO_TOP:\n                case ViewingDirection.TOP_TO_BOTTOM:\n                    _this.component.publish(BaseEvents.PREV);\n                    break;\n                case ViewingDirection.RIGHT_TO_LEFT:\n                    _this.component.publish(BaseEvents.NEXT);\n                    break;\n            }\n        });\n        this.$nextButton.onPressed(function (e) {\n            e.preventDefault();\n            OpenSeadragon.cancelEvent(e);\n            if (!that.nextButtonEnabled)\n                return;\n            switch (viewingDirection) {\n                case ViewingDirection.LEFT_TO_RIGHT:\n                case ViewingDirection.BOTTOM_TO_TOP:\n                case ViewingDirection.TOP_TO_BOTTOM:\n                    _this.component.publish(BaseEvents.NEXT);\n                    break;\n                case ViewingDirection.RIGHT_TO_LEFT:\n                    _this.component.publish(BaseEvents.PREV);\n                    break;\n            }\n        });\n        // When Prev/Next buttons are focused, make sure the controls are enabled\n        this.$prevButton.on(\"focus\", function () {\n            if (_this.controlsVisible)\n                return;\n            _this.controlsVisible = true;\n            _this.viewer.setControlsEnabled(true);\n        });\n        this.$nextButton.on(\"focus\", function () {\n            if (_this.controlsVisible)\n                return;\n            _this.controlsVisible = true;\n            _this.viewer.setControlsEnabled(true);\n        });\n    };\n    OpenSeadragonCenterPanel.prototype.openMedia = function (resources) {\n        return __awaiter(this, void 0, void 0, function () {\n            var images, i, data, tileSource;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.$spinner.show();\n                        this.items = [];\n                        return [4 /*yield*/, this.extension.getExternalResources(resources)];\n                    case 1:\n                        images = _a.sent();\n                        this.viewer.close();\n                        images = this.getPagePositions(images);\n                        for (i = 0; i < images.length; i++) {\n                            data = images[i];\n                            tileSource = void 0;\n                            if (data.hasServiceDescriptor) {\n                                tileSource = data;\n                            }\n                            else {\n                                tileSource = {\n                                    type: \"image\",\n                                    url: data.id,\n                                    buildPyramid: false\n                                };\n                            }\n                            this.viewer.addTiledImage({\n                                tileSource: tileSource,\n                                x: data.x,\n                                y: data.y,\n                                width: data.width,\n                                success: function (item) {\n                                    _this.items.push(item);\n                                    if (_this.items.length === images.length) {\n                                        _this.openPagesHandler();\n                                    }\n                                    _this.resize();\n                                }\n                            });\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    OpenSeadragonCenterPanel.prototype.getPagePositions = function (resources) {\n        var leftPage;\n        var rightPage;\n        var topPage;\n        var bottomPage;\n        var page;\n        var nextPage;\n        // if there's more than one image, determine alignment strategy\n        if (resources.length > 1) {\n            if (resources.length === 2) {\n                // recto verso\n                if (this.extension.helper.isVerticallyAligned()) {\n                    // vertical alignment\n                    topPage = resources[0];\n                    topPage.y = 0;\n                    bottomPage = resources[1];\n                    bottomPage.y = topPage.height + this.config.options.pageGap;\n                }\n                else {\n                    // horizontal alignment\n                    leftPage = resources[0];\n                    leftPage.x = 0;\n                    rightPage = resources[1];\n                    rightPage.x = leftPage.width + this.config.options.pageGap;\n                }\n            }\n            else {\n                // scroll\n                if (this.extension.helper.isVerticallyAligned()) {\n                    // vertical alignment\n                    if (this.extension.helper.isTopToBottom()) {\n                        // top to bottom\n                        for (var i = 0; i < resources.length - 1; i++) {\n                            page = resources[i];\n                            nextPage = resources[i + 1];\n                            nextPage.y = (page.y || 0) + page.height;\n                        }\n                    }\n                    else {\n                        // bottom to top\n                        for (var i = resources.length; i > 0; i--) {\n                            page = resources[i];\n                            nextPage = resources[i - 1];\n                            nextPage.y = (page.y || 0) - page.height;\n                        }\n                    }\n                }\n                else {\n                    // horizontal alignment\n                    if (this.extension.helper.isLeftToRight()) {\n                        // left to right\n                        for (var i = 0; i < resources.length - 1; i++) {\n                            page = resources[i];\n                            nextPage = resources[i + 1];\n                            nextPage.x = (page.x || 0) + page.width;\n                        }\n                    }\n                    else {\n                        // right to left\n                        for (var i = resources.length - 1; i > 0; i--) {\n                            page = resources[i];\n                            nextPage = resources[i - 1];\n                            nextPage.x = (page.x || 0) - page.width;\n                        }\n                    }\n                }\n            }\n        }\n        return resources;\n    };\n    OpenSeadragonCenterPanel.prototype.openPagesHandler = function () {\n        this.component.publish(Events.OPENSEADRAGON_OPEN);\n        if (this.extension.helper.isMultiCanvas() &&\n            !this.extension.helper.isContinuous()) {\n            this.showPrevButton();\n            this.showNextButton();\n            $(\".navigator\").addClass(\"extraMargin\");\n            var viewingDirection = this.extension.helper.getViewingDirection() ||\n                ViewingDirection.LEFT_TO_RIGHT;\n            if (viewingDirection === ViewingDirection.RIGHT_TO_LEFT) {\n                if (this.extension.helper.isFirstCanvas()) {\n                    this.disableNextButton();\n                }\n                else {\n                    this.enableNextButton();\n                }\n                if (this.extension.helper.isLastCanvas()) {\n                    this.disablePrevButton();\n                }\n                else {\n                    this.enablePrevButton();\n                }\n            }\n            else {\n                if (this.extension.helper.isFirstCanvas()) {\n                    this.disablePrevButton();\n                }\n                else {\n                    this.enablePrevButton();\n                }\n                if (this.extension.helper.isLastCanvas()) {\n                    this.disableNextButton();\n                }\n                else {\n                    this.enableNextButton();\n                }\n            }\n        }\n        this.setNavigatorVisible();\n        this.overlayAnnotations();\n        this.updateBounds();\n        // this only happens if prev/next search result were clicked and caused a reload\n        if (this.navigatedFromSearch) {\n            this.navigatedFromSearch = false;\n            this.zoomToInitialAnnotation();\n        }\n        this.isFirstLoad = false;\n    };\n    OpenSeadragonCenterPanel.prototype.zoomToInitialAnnotation = function () {\n        var annotationRect = this.getInitialAnnotationRect();\n        this.extension.previousAnnotationRect = null;\n        this.extension.currentAnnotationRect = null;\n        if (annotationRect && this.isZoomToSearchResultEnabled()) {\n            this.zoomToAnnotation(annotationRect);\n        }\n    };\n    OpenSeadragonCenterPanel.prototype.overlayAnnotations = function () {\n        var annotations = this.getAnnotationsForCurrentImages();\n        for (var i = 0; i < annotations.length; i++) {\n            var annotation = annotations[i];\n            var overlayRects = this.getAnnotationOverlayRects(annotation);\n            for (var k = 0; k < overlayRects.length; k++) {\n                var overlayRect = overlayRects[k];\n                var div = document.createElement(\"div\");\n                div.id =\n                    \"searchResult-\" +\n                        overlayRect.canvasIndex +\n                        \"-\" +\n                        overlayRect.resultIndex;\n                div.className = \"searchOverlay\";\n                div.title = sanitize(overlayRect.chars);\n                this.viewer.addOverlay(div, overlayRect);\n            }\n        }\n    };\n    OpenSeadragonCenterPanel.prototype.updateBounds = function () {\n        var settings = this.extension.getSettings();\n        // if this is the first load and there are initial bounds, fit to those.\n        if (this.isFirstLoad) {\n            this.initialRotation = (this.extension.data).rotation;\n            if (this.initialRotation) {\n                this.viewer.viewport.setRotation(parseInt(this.initialRotation));\n            }\n            this.initialBounds = (this.extension.data).xywh;\n            if (this.initialBounds) {\n                this.initialBounds = Bounds.fromString(this.initialBounds);\n                this.currentBounds = this.initialBounds;\n                this.fitToBounds(this.currentBounds);\n            }\n        }\n        else if (settings.preserveViewport) {\n            // if this isn't the first load and preserveViewport is enabled, fit to the current bounds.\n            this.fitToBounds(this.currentBounds);\n        }\n        else {\n            this.goHome();\n        }\n    };\n    OpenSeadragonCenterPanel.prototype.goHome = function () {\n        this.viewer.viewport.goHome(true);\n    };\n    OpenSeadragonCenterPanel.prototype.disablePrevButton = function () {\n        this.prevButtonEnabled = false;\n        this.$prevButton.addClass(\"disabled\");\n    };\n    OpenSeadragonCenterPanel.prototype.enablePrevButton = function () {\n        this.prevButtonEnabled = true;\n        this.$prevButton.removeClass(\"disabled\");\n    };\n    OpenSeadragonCenterPanel.prototype.hidePrevButton = function () {\n        this.disablePrevButton();\n        this.$prevButton.hide();\n    };\n    OpenSeadragonCenterPanel.prototype.showPrevButton = function () {\n        this.enablePrevButton();\n        this.$prevButton.show();\n    };\n    OpenSeadragonCenterPanel.prototype.disableNextButton = function () {\n        this.nextButtonEnabled = false;\n        this.$nextButton.addClass(\"disabled\");\n    };\n    OpenSeadragonCenterPanel.prototype.enableNextButton = function () {\n        this.nextButtonEnabled = true;\n        this.$nextButton.removeClass(\"disabled\");\n    };\n    OpenSeadragonCenterPanel.prototype.hideNextButton = function () {\n        this.disableNextButton();\n        this.$nextButton.hide();\n    };\n    OpenSeadragonCenterPanel.prototype.showNextButton = function () {\n        this.enableNextButton();\n        this.$nextButton.show();\n    };\n    OpenSeadragonCenterPanel.prototype.fitToBounds = function (bounds, immediate) {\n        var _this = this;\n        if (immediate === void 0) { immediate = true; }\n        var rect = new OpenSeadragon.Rect();\n        rect.x = Number(bounds.x);\n        rect.y = Number(bounds.y);\n        rect.width = Number(bounds.w);\n        rect.height = Number(bounds.h);\n        setTimeout(function () {\n            _this.viewer.viewport.fitBoundsWithConstraints(rect, immediate);\n        }, 100);\n    };\n    OpenSeadragonCenterPanel.prototype.getCroppedImageBounds = function () {\n        if (!this.viewer || !this.viewer.viewport)\n            return null;\n        var canvas = this.extension.helper.getCurrentCanvas();\n        var dimensions = (this.extension).getCroppedImageDimensions(canvas, this.viewer);\n        if (dimensions) {\n            var bounds = new Bounds(dimensions.regionPos.x, dimensions.regionPos.y, dimensions.region.width, dimensions.region.height);\n            return bounds.toString();\n        }\n        return null;\n    };\n    OpenSeadragonCenterPanel.prototype.getViewportBounds = function () {\n        if (!this.viewer || !this.viewer.viewport)\n            return null;\n        var b = this.viewer.viewport.getBounds(true);\n        var bounds = new Bounds(Math.floor(b.x), Math.floor(b.y), Math.floor(b.width), Math.floor(b.height));\n        return bounds;\n    };\n    OpenSeadragonCenterPanel.prototype.viewerResize = function (viewer) {\n        if (!viewer.viewport)\n            return;\n        var center = viewer.viewport.getCenter(true);\n        if (!center)\n            return;\n        // postpone pan for a millisecond - fixes iPad image stretching/squashing issue.\n        setTimeout(function () {\n            viewer.viewport.panTo(center, true);\n        }, 1);\n    };\n    OpenSeadragonCenterPanel.prototype.clearAnnotations = function () {\n        this.$canvas.find(\".searchOverlay\").hide();\n    };\n    OpenSeadragonCenterPanel.prototype.getAnnotationsForCurrentImages = function () {\n        var annotationsForCurrentImages = [];\n        var annotations = (this.extension).annotations;\n        if (!annotations || !annotations.length)\n            return annotationsForCurrentImages;\n        var indices = this.extension.getPagedIndices();\n        for (var i = 0; i < indices.length; i++) {\n            var canvasIndex = indices[i];\n            for (var j = 0; j < annotations.length; j++) {\n                if (annotations[j].canvasIndex === canvasIndex) {\n                    annotationsForCurrentImages.push(annotations[j]);\n                    break;\n                }\n            }\n        }\n        return annotationsForCurrentImages;\n    };\n    OpenSeadragonCenterPanel.prototype.getAnnotationRectsForCurrentImages = function () {\n        var annotations = this.getAnnotationsForCurrentImages();\n        if (annotations.length) {\n            return annotations\n                .map(function (x) {\n                return x.rects;\n            })\n                .reduce(function (a, b) {\n                return a.concat(b);\n            });\n        }\n        return [];\n    };\n    OpenSeadragonCenterPanel.prototype.updateVisibleAnnotationRects = function () {\n        // after animating, loop through all search result rects and flag their visibility based on whether they are inside the current viewport.\n        var annotationRects = this.getAnnotationRectsForCurrentImages();\n        for (var i = 0; i < annotationRects.length; i++) {\n            var rect = annotationRects[i];\n            var viewportBounds = this.viewer.viewport.getBounds();\n            rect.isVisible = Dimensions.hitRect(viewportBounds.x, viewportBounds.y, viewportBounds.width, viewportBounds.height, rect.viewportX, rect.viewportY);\n        }\n    };\n    OpenSeadragonCenterPanel.prototype.getAnnotationRectIndex = function (annotationRect) {\n        var annotationRects = this.getAnnotationRectsForCurrentImages();\n        return annotationRects.indexOf(annotationRect);\n    };\n    OpenSeadragonCenterPanel.prototype.isZoomToSearchResultEnabled = function () {\n        return Bools.getBool(this.extension.data.config.options.zoomToSearchResultEnabled, true);\n    };\n    OpenSeadragonCenterPanel.prototype.prevAnnotation = function () {\n        var annotationRects = this.getAnnotationRectsForCurrentImages();\n        var currentAnnotationRect = this.extension.currentAnnotationRect;\n        var currentAnnotationRectIndex = currentAnnotationRect\n            ? this.getAnnotationRectIndex(currentAnnotationRect)\n            : annotationRects.length;\n        //const currentAnnotationRectIndex: number = this.getAnnotationRectIndex(<AnnotationRect>currentAnnotationRect);\n        var foundRect = null;\n        // if there's no currentAnnotationRect selected, index is the total available annotation rects for the current images.\n        // minusing 1 makes the index the last of the available rects for the current images.\n        for (var i = currentAnnotationRectIndex - 1; i >= 0; i--) {\n            var rect = annotationRects[i];\n            // this was removed as users found it confusing.\n            // find the prev visible or non-visible rect.\n            //if (rect.isVisible) {\n            //    continue;\n            //} else {\n            foundRect = rect;\n            break;\n            //}\n        }\n        if (foundRect && this.isZoomToSearchResultEnabled()) {\n            // if the rect's canvasIndex is less than the current canvasIndex\n            if (foundRect.canvasIndex < this.extension.helper.canvasIndex) {\n                (this.extension).currentAnnotationRect = foundRect;\n                this.navigatedFromSearch = true;\n                this.component.publish(BaseEvents.ANNOTATION_CANVAS_CHANGED, [\n                    foundRect\n                ]);\n            }\n            else {\n                this.zoomToAnnotation(foundRect);\n            }\n        }\n        else {\n            this.navigatedFromSearch = true;\n            this.component.publish(Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE);\n        }\n    };\n    OpenSeadragonCenterPanel.prototype.nextAnnotation = function () {\n        var annotationRects = this.getAnnotationRectsForCurrentImages();\n        var currentAnnotationRect = this.extension.currentAnnotationRect;\n        var currentAnnotationRectIndex = currentAnnotationRect\n            ? this.getAnnotationRectIndex(currentAnnotationRect)\n            : -1;\n        var foundRect = null;\n        // if there's no currentAnnotationRect selected, index is -1.\n        // adding 1 makes the index 0 of available rects for the current images.\n        for (var i = currentAnnotationRectIndex + 1; i < annotationRects.length; i++) {\n            var rect = annotationRects[i];\n            // this was removed as users found it confusing.\n            // find the next visible or non-visible rect.\n            //if (rect.isVisible) {\n            //    continue;\n            //} else {\n            foundRect = rect;\n            break;\n            //}\n        }\n        if (foundRect && this.isZoomToSearchResultEnabled()) {\n            // if the rect's canvasIndex is greater than the current canvasIndex\n            if (foundRect.canvasIndex > this.extension.helper.canvasIndex) {\n                (this.extension).currentAnnotationRect = foundRect;\n                this.navigatedFromSearch = true;\n                this.component.publish(BaseEvents.ANNOTATION_CANVAS_CHANGED, [\n                    foundRect\n                ]);\n            }\n            else {\n                this.zoomToAnnotation(foundRect);\n            }\n        }\n        else {\n            this.navigatedFromSearch = true;\n            this.component.publish(Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE);\n        }\n    };\n    OpenSeadragonCenterPanel.prototype.getAnnotationRectByIndex = function (index) {\n        var annotationRects = this.getAnnotationRectsForCurrentImages();\n        if (!annotationRects.length)\n            return null;\n        return annotationRects[index];\n    };\n    OpenSeadragonCenterPanel.prototype.getInitialAnnotationRect = function () {\n        var _this = this;\n        var annotationRects = this.getAnnotationRectsForCurrentImages();\n        if (!annotationRects.length)\n            return null;\n        // if we've got this far it means that a reload has happened\n        // check if the lastCanvasIndex is greater or less than the current canvasIndex\n        // if greater than, select the last annotation on the current page\n        // if less than, select the first annotation on the current page\n        // otherwise default to the first annotation\n        var previousAnnotationRect = this.extension.previousAnnotationRect;\n        if (!previousAnnotationRect) {\n            if (this.extension.lastCanvasIndex > this.extension.helper.canvasIndex) {\n                var result = annotationRects.filter(function (x) { return x.canvasIndex === _this.extension.helper.canvasIndex; });\n                return result[result.length - 1];\n            }\n        }\n        return annotationRects.filter(function (x) { return x.canvasIndex === _this.extension.helper.canvasIndex; })[0];\n    };\n    OpenSeadragonCenterPanel.prototype.zoomToAnnotation = function (annotationRect) {\n        this.extension.previousAnnotationRect =\n            this.extension.currentAnnotationRect ||\n                annotationRect;\n        (this.extension).currentAnnotationRect = annotationRect;\n        // if zoomToBoundsEnabled, zoom to the annotation's bounds.\n        // otherwise, pan into view preserving the current zoom level.\n        if (Bools.getBool(this.extension.data.config.options.zoomToBoundsEnabled, false)) {\n            this.fitToBounds(new Bounds(annotationRect.viewportX, annotationRect.viewportY, annotationRect.width, annotationRect.height), false);\n        }\n        else {\n            var x = annotationRect.viewportX -\n                (this.currentBounds.w * 0.5 - annotationRect.width * 0.5);\n            var y = annotationRect.viewportY -\n                (this.currentBounds.h * 0.5 - annotationRect.height * 0.5);\n            var w = this.currentBounds.w;\n            var h = this.currentBounds.h;\n            var bounds = new Bounds(x, y, w, h);\n            this.fitToBounds(bounds);\n        }\n        this.highlightAnnotationRect(annotationRect);\n        this.component.publish(BaseEvents.ANNOTATION_CHANGED);\n    };\n    OpenSeadragonCenterPanel.prototype.highlightAnnotationRect = function (annotationRect) {\n        var $rect = $(\"#searchResult-\" + annotationRect.canvasIndex + \"-\" + annotationRect.index);\n        $rect.addClass(\"current\");\n        $(\".searchOverlay\")\n            .not($rect)\n            .removeClass(\"current\");\n    };\n    OpenSeadragonCenterPanel.prototype.getAnnotationOverlayRects = function (annotationGroup) {\n        var newRects = [];\n        if (!this.extension.resources) {\n            return newRects;\n        }\n        var resource = this.extension.resources.filter(function (x) { return x.index === annotationGroup.canvasIndex; })[0];\n        var index = this.extension.resources.indexOf(resource);\n        var offsetX = 0;\n        if (index > 0) {\n            offsetX = (this.extension.resources[index - 1]).width;\n        }\n        for (var i = 0; i < annotationGroup.rects.length; i++) {\n            var searchRect = annotationGroup.rects[i];\n            var x = searchRect.x + offsetX + (index > 0 ? this.config.options.pageGap : 0);\n            var y = searchRect.y;\n            var w = searchRect.width;\n            var h = searchRect.height;\n            var rect = new OpenSeadragon.Rect(x, y, w, h);\n            searchRect.viewportX = x;\n            searchRect.viewportY = y;\n            rect.canvasIndex = searchRect.canvasIndex;\n            rect.resultIndex = searchRect.index;\n            rect.chars = searchRect.chars;\n            newRects.push(rect);\n        }\n        return newRects;\n    };\n    OpenSeadragonCenterPanel.prototype.resize = function () {\n        var _this = this;\n        _super.prototype.resize.call(this);\n        this.$viewer.height(this.$content.height() - this.$viewer.verticalMargins());\n        this.$viewer.width(this.$content.width() - this.$viewer.horizontalMargins());\n        if (!this.isCreated)\n            return;\n        if (this.title) {\n            this.$title.text(sanitize(this.title));\n        }\n        this.$spinner.css(\"top\", this.$content.height() / 2 - this.$spinner.height() / 2);\n        this.$spinner.css(\"left\", this.$content.width() / 2 - this.$spinner.width() / 2);\n        var viewingDirection = this.extension.helper.getViewingDirection() ||\n            ViewingDirection.LEFT_TO_RIGHT;\n        if (this.extension.helper.isMultiCanvas() &&\n            this.$prevButton &&\n            this.$nextButton) {\n            var verticalButtonPos = Math.floor(this.$content.width() / 2);\n            switch (viewingDirection) {\n                case ViewingDirection.BOTTOM_TO_TOP:\n                    this.$prevButton.addClass(\"down\");\n                    this.$nextButton.addClass(\"up\");\n                    this.$prevButton.css(\"left\", verticalButtonPos - this.$prevButton.outerWidth() / 2);\n                    this.$prevButton.css(\"top\", this.$content.height() - this.$prevButton.height());\n                    this.$nextButton.css(\"left\", verticalButtonPos * -1 - this.$nextButton.outerWidth() / 2);\n                    break;\n                case ViewingDirection.TOP_TO_BOTTOM:\n                    this.$prevButton.css(\"left\", verticalButtonPos - this.$prevButton.outerWidth() / 2);\n                    this.$nextButton.css(\"left\", verticalButtonPos * -1 - this.$nextButton.outerWidth() / 2);\n                    this.$nextButton.css(\"top\", this.$content.height() - this.$nextButton.height());\n                    break;\n                default:\n                    this.$prevButton.css(\"top\", (this.$content.height() - this.$prevButton.height()) / 2);\n                    this.$nextButton.css(\"top\", (this.$content.height() - this.$nextButton.height()) / 2);\n                    break;\n            }\n        }\n        // stretch navigator, allowing time for OSD to resize\n        setTimeout(function () {\n            if (_this.extension.helper.isContinuous()) {\n                if (_this.extension.helper.isHorizontallyAligned()) {\n                    var width = _this.$viewer.width() - _this.$viewer.rightMargin();\n                    _this.$navigator.width(width);\n                }\n                else {\n                    _this.$navigator.height(_this.$viewer.height());\n                }\n            }\n        }, 100);\n    };\n    OpenSeadragonCenterPanel.prototype.setFocus = function () {\n        if (!this.$canvas.is(\":focus\")) {\n            if (this.extension.data.config.options.allowStealFocus) {\n                this.$canvas.focus();\n            }\n        }\n    };\n    OpenSeadragonCenterPanel.prototype.setNavigatorVisible = function () {\n        var navigatorEnabled = Bools.getBool(this.extension.getSettings().navigatorEnabled, true) &&\n            this.extension.isDesktopMetric();\n        this.viewer.navigator.setVisible(navigatorEnabled);\n        if (navigatorEnabled) {\n            this.$navigator.show();\n        }\n        else {\n            this.$navigator.hide();\n        }\n    };\n    return OpenSeadragonCenterPanel;\n}(CenterPanel));\nexport { OpenSeadragonCenterPanel };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { FooterPanel as BaseFooterPanel } from \"../uv-shared-module/FooterPanel\";\nimport { Events } from \"../../extensions/uv-openseadragon-extension/Events\";\nvar FooterPanel = /** @class */ (function (_super) {\n    __extends(FooterPanel, _super);\n    function FooterPanel($element) {\n        return _super.call(this, $element) || this;\n    }\n    FooterPanel.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"mobileFooterPanel\");\n        _super.prototype.create.call(this);\n        // this.$spacer = $('<div class=\"spacer\"></div>');\n        // this.$options.prepend(this.$spacer);\n        this.$rotateButton = $(\"\\n            <button class=\\\"btn imageBtn rotate\\\" title=\\\"\" + this.content.rotateRight + \"\\\">\\n                <i class=\\\"uv-icon-rotate\\\" aria-hidden=\\\"true\\\"></i>\" + this.content.rotateRight + \"\\n            </button>\\n        \");\n        this.$options.prepend(this.$rotateButton);\n        this.$zoomOutButton = $(\"\\n            <button class=\\\"btn imageBtn zoomOut\\\" title=\\\"\" + this.content.zoomOut + \"\\\">\\n                <i class=\\\"uv-icon-zoom-out\\\" aria-hidden=\\\"true\\\"></i>\" + this.content.zoomOut + \"\\n            </button>\\n        \");\n        this.$options.prepend(this.$zoomOutButton);\n        this.$zoomInButton = $(\"\\n            <button class=\\\"btn imageBtn zoomIn\\\" title=\\\"\" + this.content.zoomIn + \"\\\">\\n                <i class=\\\"uv-icon-zoom-in\\\" aria-hidden=\\\"true\\\"></i>\" + this.content.zoomIn + \"\\n            </button>\\n        \");\n        this.$options.prepend(this.$zoomInButton);\n        this.$zoomInButton.onPressed(function () {\n            _this.component.publish(Events.ZOOM_IN);\n        });\n        this.$zoomOutButton.onPressed(function () {\n            _this.component.publish(Events.ZOOM_OUT);\n        });\n        this.$rotateButton.onPressed(function () {\n            _this.component.publish(Events.ROTATE);\n        });\n    };\n    FooterPanel.prototype.resize = function () {\n        var _this = this;\n        _super.prototype.resize.call(this);\n        setTimeout(function () {\n            _this.$options.css(\"left\", Math.floor(_this.$element.width() / 2 - _this.$options.width() / 2));\n        }, 1);\n    };\n    return FooterPanel;\n}(BaseFooterPanel));\nexport { FooterPanel };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AutoComplete } from \"../uv-shared-module/AutoComplete\";\nimport { BaseEvents } from \"../uv-shared-module/BaseEvents\";\nimport { Events } from \"../../extensions/uv-openseadragon-extension/Events\";\nimport { HeaderPanel } from \"../uv-shared-module/HeaderPanel\";\nimport { Mode } from \"../../extensions/uv-openseadragon-extension/Mode\";\nimport { sanitize } from \"../../Utils\";\nimport { ViewingDirection } from \"@iiif/vocabulary\";\nimport { Bools, Strings } from \"@edsilv/utils\";\nimport { LanguageMap, ManifestType } from \"manifesto.js\";\nvar PagingHeaderPanel = /** @class */ (function (_super) {\n    __extends(PagingHeaderPanel, _super);\n    function PagingHeaderPanel($element) {\n        var _this = _super.call(this, $element) || this;\n        _this.firstButtonEnabled = false;\n        _this.lastButtonEnabled = false;\n        _this.nextButtonEnabled = false;\n        _this.prevButtonEnabled = false;\n        return _this;\n    }\n    PagingHeaderPanel.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"pagingHeaderPanel\");\n        _super.prototype.create.call(this);\n        this.component.subscribe(BaseEvents.CANVAS_INDEX_CHANGED, function (canvasIndex) {\n            _this.canvasIndexChanged(canvasIndex);\n        });\n        this.component.subscribe(BaseEvents.SETTINGS_CHANGED, function () {\n            _this.modeChanged();\n            _this.updatePagingToggle();\n        });\n        this.component.subscribe(BaseEvents.CANVAS_INDEX_CHANGE_FAILED, function () {\n            _this.setSearchFieldValue(_this.extension.helper.canvasIndex);\n        });\n        this.component.subscribe(BaseEvents.LEFTPANEL_EXPAND_FULL_START, function () {\n            _this.openGallery();\n        });\n        this.component.subscribe(BaseEvents.LEFTPANEL_COLLAPSE_FULL_START, function () {\n            _this.closeGallery();\n        });\n        this.$prevOptions = $('<div class=\"prevOptions\"></div>');\n        this.$centerOptions.append(this.$prevOptions);\n        this.$firstButton = $(\"\\n          <button class=\\\"btn imageBtn first\\\" tabindex=\\\"0\\\" title=\\\"\" + this.content.first + \"\\\">\\n            <i class=\\\"uv-icon-first\\\" aria-hidden=\\\"true\\\"></i><span>\" + this.content.first + \"</span>\\n          </button>\\n        \");\n        this.$prevOptions.append(this.$firstButton);\n        this.$prevButton = $(\"\\n          <button class=\\\"btn imageBtn prev\\\" tabindex=\\\"0\\\" title=\\\"\" + this.content.previous + \"\\\">\\n            <i class=\\\"uv-icon-prev\\\" aria-hidden=\\\"true\\\"></i><span>\" + this.content.previous + \"</span>\\n          </button>\\n        \");\n        this.$prevOptions.append(this.$prevButton);\n        this.$modeOptions = $('<div class=\"mode\"></div>');\n        this.$centerOptions.append(this.$modeOptions);\n        this.$imageModeLabel = $('<label for=\"image\">' + this.content.image + \"</label>\");\n        this.$modeOptions.append(this.$imageModeLabel);\n        this.$imageModeOption = $('<input type=\"radio\" id=\"image\" name=\"mode\" tabindex=\"0\"/>');\n        this.$modeOptions.append(this.$imageModeOption);\n        this.$pageModeLabel = $('<label for=\"page\"></label>');\n        this.$modeOptions.append(this.$pageModeLabel);\n        this.$pageModeOption = $('<input type=\"radio\" id=\"page\" name=\"mode\" tabindex=\"0\"/>');\n        this.$modeOptions.append(this.$pageModeOption);\n        this.$search = $('<div class=\"search\"></div>');\n        this.$centerOptions.append(this.$search);\n        this.$searchText = $('<input class=\"searchText\" maxlength=\"50\" type=\"text\" tabindex=\"0\" aria-label=\"' +\n            this.content.pageSearchLabel +\n            '\"/>');\n        this.$search.append(this.$searchText);\n        if (Bools.getBool(this.options.autoCompleteBoxEnabled, true)) {\n            this.$searchText.hide();\n            this.$autoCompleteBox = $('<input class=\"autocompleteText\" type=\"text\" maxlength=\"100\" aria-label=\"' +\n                this.content.pageSearchLabel +\n                '\"/>');\n            this.$search.append(this.$autoCompleteBox);\n            new AutoComplete(this.$autoCompleteBox, function (term, cb) {\n                var results = [];\n                var canvases = _this.extension.helper.getCanvases();\n                // if in page mode, get canvases by label.\n                if (_this.isPageModeEnabled()) {\n                    for (var i = 0; i < canvases.length; i++) {\n                        var canvas = canvases[i];\n                        var label = LanguageMap.getValue(canvas.getLabel());\n                        if (label && label.startsWith(term)) {\n                            results.push(label);\n                        }\n                    }\n                }\n                else {\n                    // get canvas by index\n                    for (var i = 0; i < canvases.length; i++) {\n                        var canvas = canvases[i];\n                        if (canvas.index.toString().startsWith(term)) {\n                            results.push(canvas.index.toString());\n                        }\n                    }\n                }\n                cb(results);\n            }, function (results) {\n                return results;\n            }, function (terms) {\n                _this.search(terms);\n            }, 300, 0, Bools.getBool(this.options.autocompleteAllowWords, false));\n        }\n        else if (Bools.getBool(this.options.imageSelectionBoxEnabled, true)) {\n            this.$selectionBoxOptions = $('<div class=\"image-selectionbox-options\"></div>');\n            this.$centerOptions.append(this.$selectionBoxOptions);\n            this.$imageSelectionBox = $('<select class=\"image-selectionbox\" name=\"image-select\" tabindex=\"0\" ></select>');\n            this.$selectionBoxOptions.append(this.$imageSelectionBox);\n            for (var imageIndex = 0; imageIndex < this.extension.helper.getTotalCanvases(); imageIndex++) {\n                var canvas = this.extension.helper.getCanvasByIndex(imageIndex);\n                var label = sanitize((LanguageMap.getValue(canvas.getLabel(), this.extension.helper.options.locale)));\n                this.$imageSelectionBox.append(\"<option value=\" + imageIndex + \">\" + label + \"</option>\");\n            }\n            this.$imageSelectionBox.change(function () {\n                var imageIndex = parseInt(_this.$imageSelectionBox.val());\n                _this.component.publish(Events.IMAGE_SEARCH, imageIndex);\n            });\n        }\n        this.$total = $('<span class=\"total\"></span>');\n        this.$search.append(this.$total);\n        this.$searchButton = $(\"<a class=\\\"go btn btn-primary\\\" title=\\\"\" + this.content.go + \"\\\" tabindex=\\\"0\\\">\" + this.content.go + \"</a>\");\n        this.$search.append(this.$searchButton);\n        this.$nextOptions = $('<div class=\"nextOptions\"></div>');\n        this.$centerOptions.append(this.$nextOptions);\n        this.$nextButton = $(\"\\n          <button class=\\\"btn imageBtn next\\\" tabindex=\\\"0\\\" title=\\\"\" + this.content.next + \"\\\">\\n            <i class=\\\"uv-icon-next\\\" aria-hidden=\\\"true\\\"></i><span>\" + this.content.next + \"</span>\\n          </button>\\n        \");\n        this.$nextOptions.append(this.$nextButton);\n        this.$lastButton = $(\"\\n          <button class=\\\"btn imageBtn last\\\" tabindex=\\\"0\\\" title=\\\"\" + this.content.last + \"\\\">\\n            <i class=\\\"uv-icon-last\\\" aria-hidden=\\\"true\\\"></i><span>\" + this.content.last + \"</span>\\n          </button>\\n        \");\n        this.$nextOptions.append(this.$lastButton);\n        if (this.isPageModeEnabled()) {\n            this.$pageModeOption.attr(\"checked\", \"checked\");\n            this.$pageModeOption.removeAttr(\"disabled\");\n            this.$pageModeLabel.removeClass(\"disabled\");\n        }\n        else {\n            this.$imageModeOption.attr(\"checked\", \"checked\");\n            // disable page mode option.\n            this.$pageModeOption.attr(\"disabled\", \"disabled\");\n            this.$pageModeLabel.addClass(\"disabled\");\n        }\n        if (this.extension.helper.getManifestType() === ManifestType.MANUSCRIPT) {\n            this.$pageModeLabel.text(this.content.folio);\n        }\n        else {\n            this.$pageModeLabel.text(this.content.page);\n        }\n        this.$galleryButton = $(\"\\n          <button class=\\\"btn imageBtn gallery\\\" title=\\\"\" + this.content.gallery + \"\\\" tabindex=\\\"0\\\">\\n            <i class=\\\"uv-icon-gallery\\\" aria-hidden=\\\"true\\\"></i>\" + this.content.gallery + \"\\n          </button>\\n        \");\n        this.$rightOptions.prepend(this.$galleryButton);\n        this.$pagingToggleButtons = $('<div class=\"pagingToggleButtons\"></div>');\n        this.$rightOptions.prepend(this.$pagingToggleButtons);\n        this.$oneUpButton = $(\"\\n          <button class=\\\"btn imageBtn one-up\\\" title=\\\"\" + this.content.oneUp + \"\\\" tabindex=\\\"0\\\">\\n            <i class=\\\"uv-icon-one-up\\\" aria-hidden=\\\"true\\\"></i>\" + this.content.oneUp + \"\\n          </button>\");\n        this.$pagingToggleButtons.append(this.$oneUpButton);\n        this.$twoUpButton = $(\"\\n          <button class=\\\"btn imageBtn two-up\\\" title=\\\"\" + this.content.twoUp + \"\\\" tabindex=\\\"0\\\">\\n            <i class=\\\"uv-icon-two-up\\\" aria-hidden=\\\"true\\\"></i>\" + this.content.twoUp + \"\\n          </button>\\n        \");\n        this.$pagingToggleButtons.append(this.$twoUpButton);\n        this.updatePagingToggle();\n        this.updateGalleryButton();\n        this.$oneUpButton.onPressed(function () {\n            var enabled = false;\n            _this.updateSettings({ pagingEnabled: enabled });\n            _this.component.publish(Events.PAGING_TOGGLED, enabled);\n        });\n        this.$twoUpButton.onPressed(function () {\n            var enabled = true;\n            _this.updateSettings({ pagingEnabled: enabled });\n            _this.component.publish(Events.PAGING_TOGGLED, enabled);\n        });\n        this.$galleryButton.onPressed(function () {\n            _this.component.publish(BaseEvents.TOGGLE_EXPAND_LEFT_PANEL);\n        });\n        this.setNavigationTitles();\n        this.setTotal();\n        var viewingDirection = this.extension.helper.getViewingDirection() ||\n            ViewingDirection.LEFT_TO_RIGHT;\n        // check if the book has more than one page, otherwise hide prev/next options.\n        if (this.extension.helper.getTotalCanvases() === 1) {\n            this.$centerOptions.hide();\n        }\n        // ui event handlers.\n        this.$firstButton.onPressed(function () {\n            switch (viewingDirection.toString()) {\n                case ViewingDirection.LEFT_TO_RIGHT:\n                case ViewingDirection.TOP_TO_BOTTOM:\n                case ViewingDirection.BOTTOM_TO_TOP:\n                    _this.component.publish(BaseEvents.FIRST);\n                    break;\n                case ViewingDirection.RIGHT_TO_LEFT:\n                    _this.component.publish(BaseEvents.LAST);\n                    break;\n            }\n        });\n        this.$prevButton.onPressed(function () {\n            switch (viewingDirection.toString()) {\n                case ViewingDirection.LEFT_TO_RIGHT:\n                case ViewingDirection.BOTTOM_TO_TOP:\n                case ViewingDirection.TOP_TO_BOTTOM:\n                    _this.component.publish(BaseEvents.PREV);\n                    break;\n                case ViewingDirection.RIGHT_TO_LEFT:\n                    _this.component.publish(BaseEvents.NEXT);\n                    break;\n            }\n        });\n        this.$nextButton.onPressed(function () {\n            switch (viewingDirection.toString()) {\n                case ViewingDirection.LEFT_TO_RIGHT:\n                case ViewingDirection.BOTTOM_TO_TOP:\n                case ViewingDirection.TOP_TO_BOTTOM:\n                    _this.component.publish(BaseEvents.NEXT);\n                    break;\n                case ViewingDirection.RIGHT_TO_LEFT:\n                    _this.component.publish(BaseEvents.PREV);\n                    break;\n            }\n        });\n        this.$lastButton.onPressed(function () {\n            switch (viewingDirection.toString()) {\n                case ViewingDirection.LEFT_TO_RIGHT:\n                case ViewingDirection.TOP_TO_BOTTOM:\n                case ViewingDirection.BOTTOM_TO_TOP:\n                    _this.component.publish(BaseEvents.LAST);\n                    break;\n                case ViewingDirection.RIGHT_TO_LEFT:\n                    _this.component.publish(BaseEvents.FIRST);\n                    break;\n            }\n        });\n        // If page mode is disabled, we don't need to show radio buttons since\n        // there is only one option:\n        if (!this.config.options.pageModeEnabled) {\n            this.$imageModeOption.hide();\n            this.$pageModeLabel.hide();\n            this.$pageModeOption.hide();\n        }\n        else {\n            // Only activate click actions for mode buttons when controls are\n            // visible, since otherwise, clicking on the \"Image\" label can\n            // trigger unexpected/undesired side effects.\n            this.$imageModeOption.on(\"click\", function () {\n                _this.component.publish(Events.MODE_CHANGED, Mode.image.toString());\n            });\n            this.$pageModeOption.on(\"click\", function () {\n                _this.component.publish(Events.MODE_CHANGED, Mode.page.toString());\n            });\n        }\n        this.$searchText.onEnter(function () {\n            _this.$searchText.blur();\n            _this.search(_this.$searchText.val());\n        });\n        this.$searchText.click(function () {\n            $(this).select();\n        });\n        this.$searchButton.onPressed(function () {\n            if (_this.options.autoCompleteBoxEnabled) {\n                _this.search(_this.$autoCompleteBox.val());\n            }\n            else {\n                _this.search(_this.$searchText.val());\n            }\n        });\n        if (this.options.modeOptionsEnabled === false) {\n            this.$modeOptions.hide();\n            this.$centerOptions.addClass(\"modeOptionsDisabled\");\n        }\n        // Search is shown as default\n        if (this.options.imageSelectionBoxEnabled === true &&\n            this.options.autoCompleteBoxEnabled !== true) {\n            this.$search.hide();\n        }\n        if (this.options.helpEnabled === false) {\n            this.$helpButton.hide();\n        }\n        // todo: discuss on community call\n        // Get visible element in centerOptions with greatest tabIndex\n        // var $elementWithGreatestTabIndex: JQuery = this.$centerOptions.getVisibleElementWithGreatestTabIndex();\n        // // cycle focus back to start.\n        // if ($elementWithGreatestTabIndex) {\n        //     $elementWithGreatestTabIndex.blur(() => {\n        //         if (this.extension.tabbing && !this.extension.shifted) {\n        //             this.$nextButton.focus();\n        //         }\n        //     });\n        // }\n        // this.$nextButton.blur(() => {\n        //     if (this.extension.tabbing && this.extension.shifted) {\n        //         setTimeout(() => {\n        //             $elementWithGreatestTabIndex.focus();\n        //         }, 100);\n        //     }\n        // });\n        if (!Bools.getBool(this.options.pagingToggleEnabled, true)) {\n            this.$pagingToggleButtons.hide();\n        }\n    };\n    PagingHeaderPanel.prototype.openGallery = function () {\n        this.$oneUpButton.removeClass(\"on\");\n        this.$twoUpButton.removeClass(\"on\");\n        this.$galleryButton.addClass(\"on\");\n    };\n    PagingHeaderPanel.prototype.closeGallery = function () {\n        this.updatePagingToggle();\n        this.$galleryButton.removeClass(\"on\");\n    };\n    PagingHeaderPanel.prototype.isPageModeEnabled = function () {\n        return (this.config.options.pageModeEnabled &&\n            this.extension.getMode().toString() ===\n                Mode.page.toString());\n    };\n    PagingHeaderPanel.prototype.setNavigationTitles = function () {\n        if (this.isPageModeEnabled()) {\n            if (this.extension.helper.isRightToLeft()) {\n                this.$firstButton.prop(\"title\", this.content.lastPage);\n                this.$firstButton.find(\"span\").text(this.content.lastPage);\n                this.$prevButton.prop(\"title\", this.content.nextPage);\n                this.$prevButton.find(\"span\").text(this.content.nextPage);\n                this.$nextButton.prop(\"title\", this.content.previousPage);\n                this.$nextButton.find(\"span\").text(this.content.previousPage);\n                this.$lastButton.prop(\"title\", this.content.firstPage);\n                this.$lastButton.find(\"span\").text(this.content.firstPage);\n            }\n            else {\n                this.$firstButton.prop(\"title\", this.content.firstPage);\n                this.$firstButton.find(\"span\").text(this.content.firstPage);\n                this.$prevButton.prop(\"title\", this.content.previousPage);\n                this.$prevButton.find(\"span\").text(this.content.previousPage);\n                this.$nextButton.prop(\"title\", this.content.nextPage);\n                this.$nextButton.find(\"span\").text(this.content.nextPage);\n                this.$lastButton.prop(\"title\", this.content.lastPage);\n                this.$lastButton.find(\"span\").text(this.content.lastPage);\n            }\n        }\n        else {\n            if (this.extension.helper.isRightToLeft()) {\n                this.$firstButton.prop(\"title\", this.content.lastImage);\n                this.$firstButton.find(\"span\").text(this.content.lastPage);\n                this.$prevButton.prop(\"title\", this.content.nextImage);\n                this.$prevButton.find(\"span\").text(this.content.nextImage);\n                this.$nextButton.prop(\"title\", this.content.previousImage);\n                this.$nextButton.find(\"span\").text(this.content.previousImage);\n                this.$lastButton.prop(\"title\", this.content.firstImage);\n                this.$lastButton.find(\"span\").text(this.content.firstImage);\n            }\n            else {\n                this.$firstButton.prop(\"title\", this.content.firstImage);\n                this.$firstButton.find(\"span\").text(this.content.firstImage);\n                this.$prevButton.prop(\"title\", this.content.previousImage);\n                this.$prevButton.find(\"span\").text(this.content.previousImage);\n                this.$nextButton.prop(\"title\", this.content.nextImage);\n                this.$nextButton.find(\"span\").text(this.content.nextImage);\n                this.$lastButton.prop(\"title\", this.content.lastImage);\n                this.$lastButton.find(\"span\").text(this.content.lastImage);\n            }\n        }\n    };\n    PagingHeaderPanel.prototype.updatePagingToggle = function () {\n        if (!this.pagingToggleIsVisible()) {\n            this.$pagingToggleButtons.hide();\n            return;\n        }\n        if (this.extension.isPagingSettingEnabled()) {\n            this.$oneUpButton.removeClass(\"on\");\n            this.$twoUpButton.addClass(\"on\");\n        }\n        else {\n            this.$twoUpButton.removeClass(\"on\");\n            this.$oneUpButton.addClass(\"on\");\n        }\n    };\n    PagingHeaderPanel.prototype.pagingToggleIsVisible = function () {\n        return (Bools.getBool(this.options.pagingToggleEnabled, true) &&\n            this.extension.helper.isPagingAvailable());\n    };\n    PagingHeaderPanel.prototype.updateGalleryButton = function () {\n        if (!this.galleryIsVisible()) {\n            this.$galleryButton.hide();\n        }\n    };\n    PagingHeaderPanel.prototype.galleryIsVisible = function () {\n        return (Bools.getBool(this.options.galleryButtonEnabled, true) &&\n            this.extension.isLeftPanelEnabled());\n    };\n    PagingHeaderPanel.prototype.setTotal = function () {\n        var of = this.content.of;\n        if (this.isPageModeEnabled()) {\n            this.$total.html(Strings.format(of, this.extension.helper.getLastCanvasLabel(true)));\n        }\n        else {\n            this.$total.html(Strings.format(of, this.extension.helper.getTotalCanvases().toString()));\n        }\n    };\n    PagingHeaderPanel.prototype.setSearchFieldValue = function (index) {\n        var canvas = this.extension.helper.getCanvasByIndex(index);\n        var value = null;\n        if (this.isPageModeEnabled()) {\n            var orderLabel = (LanguageMap.getValue(canvas.getLabel()));\n            if (orderLabel === \"-\") {\n                value = \"\";\n            }\n            else {\n                value = orderLabel;\n            }\n        }\n        else {\n            index += 1;\n            value = index.toString();\n        }\n        if (this.options.autoCompleteBoxEnabled) {\n            this.$autoCompleteBox.val(value);\n        }\n        else {\n            this.$searchText.val(value);\n        }\n    };\n    PagingHeaderPanel.prototype.search = function (value) {\n        if (!value) {\n            this.extension.showMessage(this.content.emptyValue);\n            this.component.publish(BaseEvents.CANVAS_INDEX_CHANGE_FAILED);\n            return;\n        }\n        if (this.isPageModeEnabled()) {\n            this.component.publish(Events.PAGE_SEARCH, value);\n        }\n        else {\n            var index = void 0;\n            if (this.options.autoCompleteBoxEnabled) {\n                index = parseInt(this.$autoCompleteBox.val(), 10);\n            }\n            else {\n                index = parseInt(this.$searchText.val(), 10);\n            }\n            index -= 1;\n            if (isNaN(index)) {\n                this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content\n                    .invalidNumber);\n                this.component.publish(BaseEvents.CANVAS_INDEX_CHANGE_FAILED);\n                return;\n            }\n            var asset = this.extension.helper.getCanvasByIndex(index);\n            if (!asset) {\n                this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content\n                    .pageNotFound);\n                this.component.publish(BaseEvents.CANVAS_INDEX_CHANGE_FAILED);\n                return;\n            }\n            this.component.publish(Events.IMAGE_SEARCH, index);\n        }\n    };\n    PagingHeaderPanel.prototype.canvasIndexChanged = function (index) {\n        this.setSearchFieldValue(index);\n        if (this.options.imageSelectionBoxEnabled === true &&\n            this.options.autoCompleteBoxEnabled !== true) {\n            this.$imageSelectionBox.val(index);\n        }\n        var viewingDirection = this.extension.helper.getViewingDirection() ||\n            ViewingDirection.LEFT_TO_RIGHT;\n        if (viewingDirection === ViewingDirection.RIGHT_TO_LEFT) {\n            if (this.extension.helper.isFirstCanvas()) {\n                this.disableLastButton();\n                this.disableNextButton();\n            }\n            else {\n                this.enableLastButton();\n                this.enableNextButton();\n            }\n            if (this.extension.helper.isLastCanvas()) {\n                this.disableFirstButton();\n                this.disablePrevButton();\n            }\n            else {\n                this.enableFirstButton();\n                this.enablePrevButton();\n            }\n        }\n        else {\n            if (this.extension.helper.isFirstCanvas()) {\n                this.disableFirstButton();\n                this.disablePrevButton();\n            }\n            else {\n                this.enableFirstButton();\n                this.enablePrevButton();\n            }\n            if (this.extension.helper.isLastCanvas()) {\n                this.disableLastButton();\n                this.disableNextButton();\n            }\n            else {\n                this.enableLastButton();\n                this.enableNextButton();\n            }\n        }\n    };\n    PagingHeaderPanel.prototype.disableFirstButton = function () {\n        this.firstButtonEnabled = false;\n        this.$firstButton.disable();\n    };\n    PagingHeaderPanel.prototype.enableFirstButton = function () {\n        this.firstButtonEnabled = true;\n        this.$firstButton.enable();\n    };\n    PagingHeaderPanel.prototype.disableLastButton = function () {\n        this.lastButtonEnabled = false;\n        this.$lastButton.disable();\n    };\n    PagingHeaderPanel.prototype.enableLastButton = function () {\n        this.lastButtonEnabled = true;\n        this.$lastButton.enable();\n    };\n    PagingHeaderPanel.prototype.disablePrevButton = function () {\n        this.prevButtonEnabled = false;\n        this.$prevButton.disable();\n    };\n    PagingHeaderPanel.prototype.enablePrevButton = function () {\n        this.prevButtonEnabled = true;\n        this.$prevButton.enable();\n    };\n    PagingHeaderPanel.prototype.disableNextButton = function () {\n        this.nextButtonEnabled = false;\n        this.$nextButton.disable();\n    };\n    PagingHeaderPanel.prototype.enableNextButton = function () {\n        this.nextButtonEnabled = true;\n        this.$nextButton.enable();\n    };\n    PagingHeaderPanel.prototype.modeChanged = function () {\n        this.setSearchFieldValue(this.extension.helper.canvasIndex);\n        this.setNavigationTitles();\n        this.setTotal();\n    };\n    PagingHeaderPanel.prototype.resize = function () {\n        _super.prototype.resize.call(this);\n        // hide toggle buttons below minimum width\n        if (this.extension.width() <\n            this.extension.data.config.options.minWidthBreakPoint) {\n            if (this.pagingToggleIsVisible())\n                this.$pagingToggleButtons.hide();\n            if (this.galleryIsVisible())\n                this.$galleryButton.hide();\n        }\n        else {\n            if (this.pagingToggleIsVisible())\n                this.$pagingToggleButtons.show();\n            if (this.galleryIsVisible())\n                this.$galleryButton.show();\n        }\n    };\n    return PagingHeaderPanel;\n}(HeaderPanel));\nexport { PagingHeaderPanel };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AutoComplete } from \"../uv-shared-module/AutoComplete\";\nimport { BaseEvents } from \"../uv-shared-module/BaseEvents\";\nimport { Events } from \"../../extensions/uv-openseadragon-extension/Events\";\nimport { FooterPanel as BaseFooterPanel } from \"../uv-shared-module/FooterPanel\";\nimport { Mode } from \"../../extensions/uv-openseadragon-extension/Mode\";\nimport { sanitize } from \"../../Utils\";\nimport { Bools, Strings } from \"@edsilv/utils\";\nimport * as KeyCodes from \"@edsilv/key-codes\";\nimport { LanguageMap } from \"manifesto.js\";\nvar FooterPanel = /** @class */ (function (_super) {\n    __extends(FooterPanel, _super);\n    function FooterPanel($element) {\n        var _this = _super.call(this, $element) || this;\n        _this.placemarkerTouched = false;\n        return _this;\n    }\n    FooterPanel.prototype.create = function () {\n        var _this = this;\n        this.setConfig(\"searchFooterPanel\");\n        _super.prototype.create.call(this);\n        this.component.subscribe(BaseEvents.CANVAS_INDEX_CHANGED, function () {\n            _this.canvasIndexChanged();\n            _this.setCurrentSearchResultPlacemarker();\n            _this.updatePrevButton();\n            _this.updateNextButton();\n        });\n        this.component.subscribe(BaseEvents.CLEAR_ANNOTATIONS, function () {\n            _this.clearSearchResults();\n        });\n        // todo: this should be a setting\n        this.component.subscribe(Events.MODE_CHANGED, function () {\n            _this.settingsChanged();\n        });\n        this.component.subscribe(Events.SEARCH, function (terms) {\n            _this.terms = terms;\n        });\n        this.component.subscribe(BaseEvents.ANNOTATIONS, function (annotationResults) {\n            _this.displaySearchResults(annotationResults.annotations, annotationResults.terms);\n            _this.setCurrentSearchResultPlacemarker();\n            _this.updatePrevButton();\n            _this.updateNextButton();\n        });\n        this.component.subscribe(BaseEvents.ANNOTATIONS_EMPTY, function () {\n            _this.hideSearchSpinner();\n        });\n        this.component.subscribe(BaseEvents.ANNOTATION_CHANGED, function () {\n            _this.updatePrevButton();\n            _this.updateNextButton();\n        });\n        this.$printButton = $(\"\\n          <button class=\\\"print btn imageBtn\\\" title=\\\"\" + this.content.print + \"\\\" tabindex=\\\"0\\\">\\n            <i class=\\\"uv-icon uv-icon-print\\\" aria-hidden=\\\"true\\\"></i>\" + this.content.print + \"\\n          </button>\\n        \");\n        this.$options.prepend(this.$printButton);\n        // search input.\n        this.$searchContainer = $('<div class=\"search\"></div>');\n        this.$element.prepend(this.$searchContainer);\n        this.$searchOptions = $('<div class=\"searchOptions\"></div>');\n        this.$searchContainer.append(this.$searchOptions);\n        this.$searchLabel = $('<span class=\"label\">' + this.content.searchWithin + \"</span>\");\n        this.$searchOptions.append(this.$searchLabel);\n        this.$searchTextContainer = $('<div class=\"searchTextContainer\"></div>');\n        this.$searchOptions.append(this.$searchTextContainer);\n        this.$searchText = $('<input class=\"searchText\" type=\"text\" maxlength=\"100\" value=\"' +\n            this.content.enterKeyword +\n            '\" aria-label=\"' +\n            this.content.searchWithin +\n            '\"/>');\n        this.$searchTextContainer.append(this.$searchText);\n        this.$searchButton = $('<a class=\"imageButton searchButton\" tabindex=\"0\"></a>');\n        this.$searchTextContainer.append(this.$searchButton);\n        // search results.\n        this.$searchPagerContainer = $('<div class=\"searchPager\"></div>');\n        this.$element.prepend(this.$searchPagerContainer);\n        this.$searchPagerControls = $('<div class=\"controls\"></div>');\n        this.$searchPagerContainer.prepend(this.$searchPagerControls);\n        this.$previousResultButton = $('<a class=\"previousResult\" title=\"' +\n            this.content.previousResult +\n            '\">' +\n            this.content.previousResult +\n            \"</a>\");\n        this.$searchPagerControls.append(this.$previousResultButton);\n        this.$searchResultsInfo = $('<div class=\"searchResultsInfo\"><span class=\"info\"><span class=\"number\">x</span> <span class=\"foundFor\"></span> \\'<span class=\"terms\">y</span>\\'</span></div>');\n        this.$searchPagerControls.append(this.$searchResultsInfo);\n        this.$clearSearchResultsButton = $('<a class=\"clearSearch\" title=\"' +\n            this.content.clearSearch +\n            '\">' +\n            this.content.clearSearch +\n            \"</a>\");\n        this.$searchResultsInfo.append(this.$clearSearchResultsButton);\n        this.$nextResultButton = $('<a class=\"nextResult\" title=\"' +\n            this.content.nextResult +\n            '\">' +\n            this.content.nextResult +\n            \"</a>\");\n        this.$searchPagerControls.append(this.$nextResultButton);\n        // placemarker line.\n        this.$searchResultsContainer = $('<div class=\"searchResults\"></div>');\n        this.$element.prepend(this.$searchResultsContainer);\n        this.$line = $('<div class=\"line\"></div>');\n        this.$searchResultsContainer.append(this.$line);\n        this.$pagePositionMarker = $('<div class=\"positionPlacemarker\"></div>');\n        this.$searchResultsContainer.append(this.$pagePositionMarker);\n        this.$pagePositionLabel = $('<div class=\"label\"></div>');\n        this.$searchResultsContainer.append(this.$pagePositionLabel);\n        this.$placemarkerDetails = $('<div class=\"placeMarkerDetails\"></div>');\n        this.$searchResultsContainer.append(this.$placemarkerDetails);\n        this.$placemarkerDetailsTop = $(\"<h1></h1>\");\n        this.$placemarkerDetails.append(this.$placemarkerDetailsTop);\n        this.$placemarkerDetailsBottom = $(\"<p></p>\");\n        this.$placemarkerDetails.append(this.$placemarkerDetailsBottom);\n        // initialise ui.\n        this.$searchPagerContainer.hide();\n        this.$placemarkerDetails.hide();\n        // ui event handlers.\n        var that = this;\n        this.$searchButton.on(\"click\", function (e) {\n            e.preventDefault();\n            _this.search(_this.$searchText.val());\n        });\n        this.$searchText.on(\"focus\", function () {\n            // clear initial text.\n            if (_this.$searchText.val() === _this.content.enterKeyword)\n                _this.$searchText.val(\"\");\n        });\n        this.$placemarkerDetails.on(\"mouseover\", function () {\n            that.component.publish(Events.SEARCH_PREVIEW_START, _this.currentPlacemarkerIndex);\n        });\n        this.$placemarkerDetails.on(\"mouseleave\", function () {\n            $(this).hide();\n            that.component.publish(Events.SEARCH_PREVIEW_FINISH);\n            // reset all placemarkers.\n            var placemarkers = that.getSearchResultPlacemarkers();\n            placemarkers.removeClass(\"hover\");\n        });\n        this.$placemarkerDetails.on(\"click\", function () {\n            that.component.publish(BaseEvents.CANVAS_INDEX_CHANGED, _this.currentPlacemarkerIndex);\n        });\n        this.$previousResultButton.on(\"click\", function (e) {\n            e.preventDefault();\n            if (_this.isPreviousButtonEnabled()) {\n                that.component.publish(Events.PREV_SEARCH_RESULT);\n            }\n        });\n        this.$nextResultButton.on(\"click\", function (e) {\n            e.preventDefault();\n            if (_this.isNextButtonEnabled()) {\n                that.component.publish(Events.NEXT_SEARCH_RESULT);\n            }\n        });\n        this.$clearSearchResultsButton.on(\"click\", function (e) {\n            e.preventDefault();\n            that.component.publish(BaseEvents.CLEAR_ANNOTATIONS);\n        });\n        // hide search options if not enabled/supported.\n        if (!this.isSearchEnabled()) {\n            this.$searchContainer.hide();\n            this.$searchPagerContainer.hide();\n            this.$searchResultsContainer.hide();\n            this.$element.addClass(\"min\");\n        }\n        if (this.extension.helper.getTotalCanvases() === 1) {\n            this.$searchResultsContainer.hide();\n        }\n        var autocompleteService = (this.extension).getAutoCompleteUri();\n        if (autocompleteService) {\n            new AutoComplete(this.$searchText, function (terms, cb) {\n                $.getJSON(Strings.format(autocompleteService, terms), function (results) {\n                    cb(results);\n                });\n            }, function (results) {\n                return $.map(results.terms, function (result) {\n                    return result.match;\n                });\n            }, function (terms) {\n                _this.search(terms);\n            }, 300, 2, true, Bools.getBool(this.options.autocompleteAllowWords, false));\n        }\n        else {\n            this.$searchText.on(\"keyup\", function (e) {\n                if (e.keyCode === KeyCodes.KeyDown.Enter) {\n                    that.search(that.$searchText.val());\n                }\n            });\n        }\n        this.$printButton.onPressed(function () {\n            that.component.publish(Events.PRINT);\n        });\n        this.updatePrintButton();\n        var positionMarkerEnabled = Bools.getBool(this.config.options.positionMarkerEnabled, true);\n        if (!positionMarkerEnabled) {\n            this.$pagePositionMarker.hide();\n            this.$pagePositionLabel.hide();\n        }\n    };\n    FooterPanel.prototype.isSearchEnabled = function () {\n        return this.extension.isSearchEnabled();\n    };\n    FooterPanel.prototype.isZoomToSearchResultEnabled = function () {\n        return Bools.getBool(this.extension.data.config.options.zoomToSearchResultEnabled, true);\n    };\n    FooterPanel.prototype.isPreviousButtonEnabled = function () {\n        var currentCanvasIndex = this.extension.helper.canvasIndex;\n        var firstSearchResultCanvasIndex = this.getFirstSearchResultCanvasIndex();\n        var currentSearchResultRectIndex = this.getCurrentSearchResultRectIndex();\n        // if zoom to search result is enabled and there is a highlighted search result.\n        if (this.isZoomToSearchResultEnabled() &&\n            this.extension.currentAnnotationRect) {\n            if (currentCanvasIndex < firstSearchResultCanvasIndex) {\n                return false;\n            }\n            else if (currentCanvasIndex === firstSearchResultCanvasIndex) {\n                if (currentSearchResultRectIndex === 0) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        return currentCanvasIndex > firstSearchResultCanvasIndex;\n    };\n    FooterPanel.prototype.isNextButtonEnabled = function () {\n        var currentCanvasIndex = this.extension.helper.canvasIndex;\n        var lastSearchResultCanvasIndex = this.getLastSearchResultCanvasIndex();\n        var currentSearchResultRectIndex = this.getCurrentSearchResultRectIndex();\n        // if zoom to search result is enabled and there is a highlighted search result.\n        if (this.isZoomToSearchResultEnabled() &&\n            this.extension.currentAnnotationRect) {\n            if (currentCanvasIndex > lastSearchResultCanvasIndex) {\n                return false;\n            }\n            else if (currentCanvasIndex === lastSearchResultCanvasIndex) {\n                if (currentSearchResultRectIndex === this.getLastSearchResultRectIndex()) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        return currentCanvasIndex < lastSearchResultCanvasIndex;\n    };\n    FooterPanel.prototype.getSearchResults = function () {\n        return this.extension.annotations;\n    };\n    FooterPanel.prototype.getCurrentSearchResultRectIndex = function () {\n        return (this.extension).getCurrentAnnotationRectIndex();\n    };\n    FooterPanel.prototype.getFirstSearchResultCanvasIndex = function () {\n        var searchResults = this.getSearchResults();\n        if (!searchResults)\n            return -1;\n        var firstSearchResultCanvasIndex = searchResults[0].canvasIndex;\n        return firstSearchResultCanvasIndex;\n    };\n    FooterPanel.prototype.getLastSearchResultCanvasIndex = function () {\n        var searchResults = this.getSearchResults();\n        if (!searchResults)\n            return -1;\n        var lastSearchResultCanvasIndex = searchResults[searchResults.length - 1].canvasIndex;\n        return lastSearchResultCanvasIndex;\n    };\n    FooterPanel.prototype.getLastSearchResultRectIndex = function () {\n        return (this.extension).getLastAnnotationRectIndex();\n    };\n    FooterPanel.prototype.updateNextButton = function () {\n        var searchResults = this.getSearchResults();\n        if (searchResults && searchResults.length) {\n            if (this.isNextButtonEnabled()) {\n                this.$nextResultButton.removeClass(\"disabled\");\n            }\n            else {\n                this.$nextResultButton.addClass(\"disabled\");\n            }\n        }\n    };\n    FooterPanel.prototype.updatePrevButton = function () {\n        var searchResults = this.getSearchResults();\n        if (searchResults && searchResults.length) {\n            if (this.isPreviousButtonEnabled()) {\n                this.$previousResultButton.removeClass(\"disabled\");\n            }\n            else {\n                this.$previousResultButton.addClass(\"disabled\");\n            }\n        }\n    };\n    FooterPanel.prototype.updatePrintButton = function () {\n        var configEnabled = Bools.getBool(this.options.printEnabled, false);\n        //var printService: manifesto.Service = this.extension.helper.manifest.getService(manifesto.ServiceProfile.printExtensions());\n        //if (configEnabled && printService && this.extension.isOnHomeDomain()){\n        if (configEnabled) {\n            this.$printButton.show();\n        }\n        else {\n            this.$printButton.hide();\n        }\n    };\n    FooterPanel.prototype.search = function (terms) {\n        this.terms = terms;\n        if (this.terms === \"\" || this.terms === this.content.enterKeyword) {\n            this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.emptyValue, function () {\n                this.$searchText.focus();\n            });\n            return;\n        }\n        // blur search field\n        this.$searchText.blur();\n        this.showSearchSpinner();\n        this.component.publish(Events.SEARCH, this.terms);\n    };\n    FooterPanel.prototype.getSearchResultPlacemarkers = function () {\n        return this.$searchResultsContainer.find(\".searchResultPlacemarker\");\n    };\n    FooterPanel.prototype.setCurrentSearchResultPlacemarker = function () {\n        var placemarkers = this.getSearchResultPlacemarkers();\n        placemarkers\n            .parent()\n            .find(\".current\")\n            .removeClass(\"current\");\n        var $current = $('.searchResultPlacemarker[data-index=\"' +\n            this.extension.helper.canvasIndex +\n            '\"]');\n        $current.addClass(\"current\");\n    };\n    FooterPanel.prototype.positionSearchResultPlacemarkers = function () {\n        var searchResults = this.getSearchResults();\n        if (!searchResults || !searchResults.length)\n            return;\n        // clear all existing placemarkers\n        var placemarkers = this.getSearchResultPlacemarkers();\n        placemarkers.remove();\n        var pageWidth = this.getPageLineRatio();\n        var lineTop = this.$line.position().top;\n        var lineLeft = this.$line.position().left;\n        var that = this;\n        // for each page with a result, place a marker along the line.\n        for (var i = 0; i < searchResults.length; i++) {\n            var result = searchResults[i];\n            var distance = result.canvasIndex * pageWidth;\n            var $placemarker = $('<div class=\"searchResultPlacemarker\" data-index=\"' +\n                result.canvasIndex +\n                '\"></div>');\n            $placemarker[0].ontouchstart = function (e) {\n                that.onPlacemarkerTouchStart.call(this, that);\n            };\n            $placemarker.click(function (e) {\n                that.onPlacemarkerClick.call(this, that);\n            });\n            $placemarker.mouseenter(function (e) {\n                that.onPlacemarkerMouseEnter.call(this, that);\n            });\n            $placemarker.mouseleave(function (e) {\n                that.onPlacemarkerMouseLeave.call(this, e, that);\n            });\n            this.$searchResultsContainer.append($placemarker);\n            var top_1 = lineTop - $placemarker.height();\n            var left = lineLeft + distance - $placemarker.width() / 2;\n            $placemarker.css({\n                top: top_1,\n                left: left\n            });\n        }\n    };\n    FooterPanel.prototype.onPlacemarkerTouchStart = function (that) {\n        that.placemarkerTouched = true;\n        //const $placemarker: JQuery = $(this);\n        //const index: number = parseInt($placemarker.attr('data-index'));\n        //this.component.publish(Events.VIEW_PAGE, [index]);\n    };\n    FooterPanel.prototype.onPlacemarkerClick = function (that) {\n        if (that.placemarkerTouched)\n            return;\n        that.placemarkerTouched = false;\n        //const $placemarker: JQuery = $(this);\n        //const index: number = parseInt($placemarker.attr('data-index'));\n        //this.component.publish(Events.VIEW_PAGE, [index]);\n    };\n    FooterPanel.prototype.onPlacemarkerMouseEnter = function (that) {\n        if (that.placemarkerTouched)\n            return;\n        var $placemarker = $(this);\n        $placemarker.addClass(\"hover\");\n        var canvasIndex = parseInt($placemarker.attr(\"data-index\"));\n        that.component.publish(Events.SEARCH_PREVIEW_START, canvasIndex);\n        var $placemarkers = that.getSearchResultPlacemarkers();\n        var elemIndex = $placemarkers.index($placemarker[0]);\n        that.currentPlacemarkerIndex = canvasIndex;\n        that.$placemarkerDetails.show();\n        var title = \"{0} {1}\";\n        if (that.isPageModeEnabled()) {\n            var canvas = that.extension.helper.getCanvasByIndex(canvasIndex);\n            var label = LanguageMap.getValue(canvas.getLabel());\n            if (!label && this.extension.helper.manifest) {\n                label = this.extension.helper.manifest.options.defaultLabel;\n            }\n            if (label) {\n                title = Strings.format(title, that.content.pageCaps, label);\n            }\n        }\n        else {\n            title = Strings.format(title, that.content.imageCaps, String(canvasIndex + 1));\n        }\n        that.$placemarkerDetailsTop.html(title);\n        var searchResults = that.getSearchResults();\n        if (searchResults) {\n            var result = searchResults[elemIndex];\n            var terms = \"\";\n            if (that.terms) {\n                terms = Strings.ellipsis(that.terms, that.options.elideDetailsTermsCount);\n            }\n            var instanceFoundText = that.content.instanceFound;\n            var instancesFoundText = that.content.instancesFound;\n            var text = \"\";\n            if (result.rects.length === 1) {\n                text = Strings.format(instanceFoundText, terms);\n                that.$placemarkerDetailsBottom.html(text);\n            }\n            else {\n                text = Strings.format(instancesFoundText, String(result.rects.length), terms);\n                that.$placemarkerDetailsBottom.html(text);\n            }\n        }\n        var pos = $placemarker.position();\n        var top = pos.top - that.$placemarkerDetails.height();\n        var left = pos.left;\n        if (left < that.$placemarkerDetails.width() / 2) {\n            left = 0 - $placemarker.width() / 2;\n        }\n        else if (left >\n            that.$line.width() - that.$placemarkerDetails.width() / 2) {\n            left =\n                that.$line.width() -\n                    that.$placemarkerDetails.width() +\n                    $placemarker.width() / 2;\n        }\n        else {\n            left -= that.$placemarkerDetails.width() / 2;\n        }\n        that.$placemarkerDetails.css({\n            top: top,\n            left: left\n        });\n    };\n    FooterPanel.prototype.onPlacemarkerMouseLeave = function (e, that) {\n        that.component.publish(Events.SEARCH_PREVIEW_FINISH);\n        var $placemarker = $(this);\n        var newElement = e.toElement || e.relatedTarget;\n        var isChild = $(newElement).closest(that.$placemarkerDetails)\n            .length;\n        if (newElement != that.$placemarkerDetails.get(0) && isChild === 0) {\n            that.$placemarkerDetails.hide();\n            $placemarker.removeClass(\"hover\");\n        }\n    };\n    FooterPanel.prototype.setPageMarkerPosition = function () {\n        if (this.extension.helper.canvasIndex === null)\n            return;\n        // position placemarker showing current page.\n        var pageLineRatio = this.getPageLineRatio();\n        var lineTop = this.$line.position().top;\n        var lineLeft = this.$line.position().left;\n        var position = this.extension.helper.canvasIndex * pageLineRatio;\n        var top = lineTop;\n        var left = lineLeft + position;\n        this.$pagePositionMarker.css({\n            top: top,\n            left: left\n        });\n        // if the remaining distance to the right is less than the width of the label\n        // shift it to the left.\n        var lineWidth = this.$line.width();\n        if (left + this.$pagePositionLabel.outerWidth(true) > lineWidth) {\n            left -= this.$pagePositionLabel.outerWidth(true);\n            this.$pagePositionLabel.removeClass(\"right\");\n            this.$pagePositionLabel.addClass(\"left\");\n        }\n        else {\n            this.$pagePositionLabel.removeClass(\"left\");\n            this.$pagePositionLabel.addClass(\"right\");\n        }\n        this.$pagePositionLabel.css({\n            top: top,\n            left: left\n        });\n    };\n    FooterPanel.prototype.clearSearchResults = function () {\n        if (!this.isSearchEnabled()) {\n            return;\n        }\n        // clear all existing placemarkers\n        var $placemarkers = this.getSearchResultPlacemarkers();\n        $placemarkers.remove();\n        // clear search input field.\n        this.$searchText.val(this.content.enterKeyword);\n        // hide pager.\n        this.$searchContainer.show();\n        this.$searchPagerContainer.hide();\n        // set focus to search box.\n        this.$searchText.focus();\n    };\n    FooterPanel.prototype.getPageLineRatio = function () {\n        var lineWidth = this.$line.width();\n        // find page/width ratio by dividing the line width by the number of pages in the book.\n        if (this.extension.helper.getTotalCanvases() === 1)\n            return 0;\n        return lineWidth / (this.extension.helper.getTotalCanvases() - 1);\n    };\n    FooterPanel.prototype.canvasIndexChanged = function () {\n        this.setPageMarkerPosition();\n        this.setPlacemarkerLabel();\n    };\n    FooterPanel.prototype.settingsChanged = function () {\n        this.setPlacemarkerLabel();\n    };\n    FooterPanel.prototype.setPlacemarkerLabel = function () {\n        var displaying = this.content.displaying;\n        var index = this.extension.helper.canvasIndex;\n        if (this.isPageModeEnabled()) {\n            var canvas = this.extension.helper.getCanvasByIndex(index);\n            var label = LanguageMap.getValue(canvas.getLabel());\n            if (!label) {\n                label = this.content.defaultLabel;\n            }\n            var lastCanvasOrderLabel = this.extension.helper.getLastCanvasLabel(true);\n            if (lastCanvasOrderLabel) {\n                this.$pagePositionLabel.html(Strings.format(displaying, this.content.page, sanitize(label), sanitize(lastCanvasOrderLabel)));\n            }\n        }\n        else {\n            this.$pagePositionLabel.html(Strings.format(displaying, this.content.image, String(index + 1), this.extension.helper.getTotalCanvases().toString()));\n        }\n    };\n    FooterPanel.prototype.isPageModeEnabled = function () {\n        return (this.config.options.pageModeEnabled &&\n            this.extension.getMode().toString() ===\n                Mode.page.toString() &&\n            !Bools.getBool(this.config.options.forceImageMode, false));\n    };\n    FooterPanel.prototype.showSearchSpinner = function () {\n        this.$searchText.addClass(\"searching\");\n    };\n    FooterPanel.prototype.hideSearchSpinner = function () {\n        this.$searchText.removeClass(\"searching\");\n    };\n    FooterPanel.prototype.displaySearchResults = function (results, terms) {\n        if (!this.isSearchEnabled()) {\n            return;\n        }\n        this.hideSearchSpinner();\n        this.positionSearchResultPlacemarkers();\n        // show pager.\n        this.$searchContainer.hide();\n        this.$searchPagerControls.css({\n            left: 0\n        });\n        var $info = this.$searchResultsInfo.find(\".info\");\n        var $number = $info.find(\".number\");\n        var $foundFor = $info.find(\".foundFor\");\n        var $terms = $info.find(\".terms\");\n        if (terms) {\n            $info.show();\n            $number.text(this.extension.getTotalAnnotationRects());\n            if (results.length === 1) {\n                $foundFor.html(this.content.resultFoundFor);\n            }\n            else {\n                $foundFor.html(this.content.resultsFoundFor);\n            }\n            $terms.html(Strings.ellipsis(terms, this.options.elideResultsTermsCount));\n            $terms.prop(\"title\", terms);\n        }\n        else {\n            $info.hide();\n        }\n        this.$searchPagerContainer.show();\n        this.resize();\n    };\n    FooterPanel.prototype.resize = function () {\n        _super.prototype.resize.call(this);\n        var searchResults = this.getSearchResults();\n        if (searchResults && searchResults.length) {\n            this.positionSearchResultPlacemarkers();\n        }\n        this.setPageMarkerPosition();\n        this.$searchPagerContainer.width(this.$element.width());\n        var center = this.$element.width() / 2;\n        // position search pager controls.\n        this.$searchPagerControls.css({\n            left: center - this.$searchPagerControls.width() / 2\n        });\n        // position search input.\n        this.$searchOptions.css({\n            left: center - this.$searchOptions.outerWidth() / 2\n        });\n    };\n    return FooterPanel;\n}(BaseFooterPanel));\nexport { FooterPanel };\n","var AnnotationResults = /** @class */ (function () {\n    function AnnotationResults() {\n    }\n    return AnnotationResults;\n}());\nexport { AnnotationResults };\n","import * as KeyCodes from \"@edsilv/key-codes\";\nimport { Keyboard } from \"@edsilv/utils\";\nvar AutoComplete = /** @class */ (function () {\n    function AutoComplete(element, autoCompleteFunc, parseResultsFunc, onSelect, delay, minChars, positionAbove, allowWords) {\n        var _this = this;\n        if (delay === void 0) { delay = 300; }\n        if (minChars === void 0) { minChars = 2; }\n        if (positionAbove === void 0) { positionAbove = false; }\n        if (allowWords === void 0) { allowWords = false; }\n        this._$element = element;\n        this._autoCompleteFunc = autoCompleteFunc;\n        this._delay = delay;\n        this._minChars = minChars;\n        this._onSelect = onSelect;\n        this._parseResultsFunc = parseResultsFunc;\n        this._positionAbove = positionAbove;\n        this._allowWords = allowWords;\n        // create ui.\n        this._$searchResultsList = $('<ul class=\"autocomplete\"></ul>');\n        if (this._positionAbove) {\n            this._$element.parent().prepend(this._$searchResultsList);\n        }\n        else {\n            this._$element.parent().append(this._$searchResultsList);\n        }\n        this._$searchResultTemplate = $('<li class=\"result\"><a href=\"#\" tabindex=\"-1\"></a></li>');\n        // init ui.\n        // callback after set period.\n        var typewatch = (function () {\n            var timer = 0;\n            return function (cb, ms) {\n                clearTimeout(timer);\n                timer = setTimeout(cb, ms);\n            };\n        })();\n        var that = this;\n        this._$element.on(\"keydown\", function (e) {\n            var originalEvent = e.originalEvent;\n            //that._lastKeyDownWasNavigation = that._isNavigationKeyDown(originalEvent);\n            var charCode = Keyboard.getCharCode(originalEvent);\n            var cancelEvent = false;\n            if (charCode === KeyCodes.KeyDown.LeftArrow) {\n                cancelEvent = true;\n            }\n            else if (charCode === KeyCodes.KeyDown.RightArrow) {\n                cancelEvent = true;\n            }\n            if (cancelEvent) {\n                originalEvent.cancelBubble = true;\n                if (originalEvent.stopPropagation)\n                    originalEvent.stopPropagation();\n            }\n        });\n        // auto complete\n        this._$element.on(\"keyup\", function (e) {\n            // if pressing enter without a list item selected\n            if (!that._getSelectedListItem().length &&\n                e.keyCode === KeyCodes.KeyDown.Enter) {\n                // enter\n                that._onSelect(that._getTerms());\n                return;\n            }\n            // If there are search results\n            if (that._$searchResultsList.is(\":visible\") && that._results.length) {\n                if (e.keyCode === KeyCodes.KeyDown.Enter) {\n                    that._searchForItem(that._getSelectedListItem());\n                }\n                else if (e.keyCode === KeyCodes.KeyDown.DownArrow) {\n                    that._setSelectedResultIndex(1);\n                    return;\n                }\n                else if (e.keyCode === KeyCodes.KeyDown.UpArrow) {\n                    that._setSelectedResultIndex(-1);\n                    return;\n                }\n            }\n            if (e.keyCode !== KeyCodes.KeyDown.Enter) {\n                // after a delay, show autocomplete list.\n                typewatch(function () {\n                    var val = that._getTerms();\n                    // if there are more than x chars\n                    // update the autocomplete list.\n                    if (val && val.length > that._minChars && that._searchForWords(val)) {\n                        that._search(val);\n                    }\n                    else {\n                        // otherwise, hide the autocomplete list.\n                        that._clearResults();\n                        that._hideResults();\n                    }\n                }, that._delay);\n            }\n        });\n        // hide results if clicked outside.\n        $(document).on(\"mouseup\", function (e) {\n            if (_this._$searchResultsList.parent().has($(e.target)[0]).length === 0) {\n                _this._clearResults();\n                _this._hideResults();\n            }\n        });\n        this._hideResults();\n    }\n    AutoComplete.prototype._searchForWords = function (search) {\n        if (this._allowWords || !search.includes(\" \")) {\n            return true;\n        }\n        else {\n            return false;\n        }\n    };\n    AutoComplete.prototype._getTerms = function () {\n        return this._$element.val().trim();\n    };\n    AutoComplete.prototype._setSelectedResultIndex = function (direction) {\n        var nextIndex;\n        if (direction === 1) {\n            nextIndex = this._selectedResultIndex + 1;\n        }\n        else {\n            nextIndex = this._selectedResultIndex - 1;\n        }\n        var $items = this._$searchResultsList.find(\"li\");\n        if (nextIndex < 0) {\n            nextIndex = $items.length - 1;\n        }\n        else if (nextIndex > $items.length - 1) {\n            nextIndex = 0;\n        }\n        this._selectedResultIndex = nextIndex;\n        $items.removeClass(\"selected\");\n        var $selectedItem = $items.eq(this._selectedResultIndex);\n        $selectedItem.addClass(\"selected\");\n        var top = $selectedItem.outerHeight(true) * this._selectedResultIndex;\n        this._$searchResultsList.scrollTop(top);\n    };\n    AutoComplete.prototype._search = function (term) {\n        this._results = [];\n        this._clearResults();\n        this._showResults();\n        this._$searchResultsList.append('<li class=\"loading\"></li>');\n        this._updateListPosition();\n        var that = this;\n        this._autoCompleteFunc(term, function (results) {\n            that._listResults(results);\n        });\n    };\n    AutoComplete.prototype._clearResults = function () {\n        this._$searchResultsList.empty();\n    };\n    AutoComplete.prototype._hideResults = function () {\n        this._$searchResultsList.hide();\n    };\n    AutoComplete.prototype._showResults = function () {\n        this._selectedResultIndex = -1;\n        this._$searchResultsList.show();\n    };\n    AutoComplete.prototype._updateListPosition = function () {\n        if (this._positionAbove) {\n            this._$searchResultsList.css({\n                top: this._$searchResultsList.outerHeight(true) * -1\n            });\n        }\n        else {\n            this._$searchResultsList.css({\n                top: this._$element.outerHeight(true)\n            });\n        }\n    };\n    AutoComplete.prototype._listResults = function (results) {\n        // get an array of strings\n        this._results = this._parseResultsFunc(results);\n        this._clearResults();\n        if (!this._results.length) {\n            // don't do this, because there still may be results for the PHRASE but not the word.\n            // they won't know until they do the search.\n            //this.searchResultsList.append('<li>no results</li>');\n            this._hideResults();\n            return;\n        }\n        for (var i = 0; i < this._results.length; i++) {\n            var result = this._results[i];\n            var $resultItem = this._$searchResultTemplate.clone();\n            var $a = $resultItem.find(\"a\");\n            $a.text(result);\n            this._$searchResultsList.append($resultItem);\n        }\n        this._updateListPosition();\n        var that = this;\n        this._$searchResultsList.find(\"li\").on(\"click\", function (e) {\n            e.preventDefault();\n            that._searchForItem($(this));\n        });\n    };\n    AutoComplete.prototype._searchForItem = function ($item) {\n        var term = $item.find(\"a\").text();\n        this._$element.val(term);\n        this._hideResults();\n        this._onSelect(term);\n        this._clearResults();\n        this._hideResults();\n    };\n    AutoComplete.prototype._getSelectedListItem = function () {\n        return this._$searchResultsList.find(\"li.selected\");\n    };\n    return AutoComplete;\n}());\nexport { AutoComplete };\n","var Point = /** @class */ (function () {\n    function Point(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n    return Point;\n}());\nexport { Point };\n"],"sourceRoot":""}